webpackJsonp([25],{"+uwV":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("mvHQ"),o=a.n(n),s=a("p8P9"),i=a("X2sI"),c=a("LuSo"),r=a("wdqF"),l=a("8sRp"),u=a("KxKW"),p=a("JtJ0"),h=a("HYs4"),d=a("NHTL"),v=a("yoLw"),f=a("EMb8"),m=a("NAz/"),g=a("a84E"),_=a("7+uW"),D=a("wDsp"),k=a("TIfe");_.a.component("Row",g.a),_.a.component("Col",m.a),_.a.component("Icon",f.a),_.a.component("Table",v.a),_.a.component("Tag",d.a),_.a.component("Page",h.a),_.a.component("Input",p.a),_.a.component("Button",u.a),_.a.component("Modal",l.a),_.a.component("Spin",r.a),_.a.component("Select",c.a),_.a.component("Option",i.a),_.a.component("AutoComplete",s.a);var y={name:"check_manage",components:{},props:{},data:function(){return{totalCount:0,pageSize:10,currentPage:1,pageSizeOptions:[10,20,30,40,50,60,70,80,90,100],tableLoading:!0,uploadModal:!1,achieveUpload:!1,errorUpload:!1,selection:[],deviceDetailData:[],inputData:[],inputDataAll:[],queryData:{assetName:"",assetID:"",memorydepart:"",memorylocDept:""},assetsDetailColumn:[{title:"选择",slot:"selection",type:"selection",width:80},{title:"资产id",key:"assetID"},{title:"通用名称",key:"generalName"},{title:"资产名称",key:"assetName"},{title:"规格",key:"specification"},{title:"型号",key:"type"},{title:"存放地点",key:"location"},{title:"产地",key:"placeoforigin"},{title:"品牌",key:"brand"},{title:"部门编码",key:"departmentcode"},{title:"部门名称",key:"departmentroom"},{title:"大科室编码",key:"homeofficenumber"},{title:"大科室名称",key:"homeofficename"},{title:"是否进口",key:"isentrance"},{title:"供应商名称",key:"suppliername"},{title:"生产厂商名称",key:"generatebusinessname"},{title:"所在科室名称",key:"locDept"},{title:"盘点",key:"check",slot:"check",width:180},{title:"状态",key:"status",slot:"status",width:100}],assetsDetailData:[]}},watch:{deviceDetailData:function(){var t=this;this.deviceDetailData.forEach(function(e,a){t.assetsDetailData.forEach(function(t,a){e.Mac===t.mac&&(t.location=e.Location)})})}},computed:{},methods:{handleSearchFn:function(t){this.inputData=this.inputDataAll.filter(function(e){return e.toLowerCase().indexOf(t.toLowerCase())>-1})},inputBlurFn:function(){this.inputDataAll=[],this.inputData=[]},inputFocusFn:function(t){var e=this;this.inputDataAll=[],this.inputData=[];var a=[],n={};n[t]="1",a.push(n),this.$axios.post(D.a.inputQuery,a).then(function(a){a.data.data.forEach(function(a,n){e.inputDataAll.find(function(e){return e===a[t]})||e.inputDataAll.push(a[t])}),e.inputData=JSON.parse(o()(e.inputDataAll))}).catch(function(t){console.log(t)})},searchAssetsFn:function(){this.currentPage=1,this.getDataFn()},clearAssetsFn:function(){for(var t in this.queryData)this.queryData[t]=""},initTimeFn:function(){var t=new Date,e=t.getFullYear(),a=t.getMonth()+1,n=t.getDate(),o=t.getHours(),s=t.getMinutes(),i=t.getSeconds();return e+"-"+(a=a<10?"0"+a:a)+"-"+(n=n<10?"0"+n:n)+" "+(o=o<10?"0"+o:o)+":"+(s=s<10?"0"+s:s)+":"+(i=i<10?"0"+i:i)},changePageFn:function(t){this.tableLoading=!0,this.currentPage=t,this.getDataFn()},changePageSizeFn:function(t){this.pageSize=t,this.currentPage=1,this.getDataFn()},checkAllGroupChange:function(t){this.selection=t},checkFn:function(){var t=this;if(!this.selection.length)return this.$Message.error({content:"请选择至少一项!",duration:2});this.selection.length>1?this.$Modal.confirm({title:"盘点提示！",okText:"确定",cancelText:"取消",content:'<h2 style="color:#f94040">你确定要同时盘点这'+this.selection.length+"个资产吗？</h2>",onOk:function(){t.checkCertainFn()}}):this.checkCertainFn()},checkCertainFn:function(){var t=this,e=[];this.selection.forEach(function(a,n){var o={assetID:a.assetID,check:t.initTimeFn()};e.push(o)}),this.uploadModal=!0,this.$axios.post(D.a.assetsUpdate,e).then(function(e){"ok"===e.data.msg?t.successFn():e.data.message?(t.errorFn(),l.a.error({title:"错误提示！",content:e.data.message,okText:"确定"})):"failed"===e.data.msg&&(t.errorFn(),l.a.error({title:"错误提示！",content:e.data.message,okText:"确定"}))}).catch(function(t){l.a.error({title:"错误提示！",content:t,okText:"确定"})})},successFn:function(){var t=this;this.achieveUpload=!0,setTimeout(function(){t.uploadModal=!1,setTimeout(function(){t.achieveUpload=!1,t.errorUpload=!1,t.getDataFn()},500)},1e3)},errorFn:function(){var t=this;this.errorUpload=!0,setTimeout(function(){t.uploadModal=!1,setTimeout(function(){t.achieveUpload=!1,t.errorUpload=!1},500)},1e3)},getDataFn:function(){var t=this;this.tableLoading=!0,this.$Loading.start();var e="";for(var a in this.queryData)this.queryData[a]||(this.queryData[a]=""),e+=a+"="+this.queryData[a].trim()+"&";e=e.substring(0,e.length-1),this.$axios.post(D.a.assetsQuery+"?currentPage="+this.currentPage+"&pageSize="+this.pageSize+"&"+e).then(function(e){var a=e.data,n=Number(a.pop().total);t.assetsDetailData=[];for(var o=0;o<a.length;o++){for(var s in a[o])""!==a[o][s]&&"null"!==a[o][s]||(a[o][s]="--");t.assetsDetailData.push(a[o])}t.totalCount=n,t.tableLoading=!1,t.$Loading.finish()}).catch(function(e){t.$Loading.error()})},transWebsocketFn:function(t){var e=[],a=t.split("{");return a.splice(0,1),a.forEach(function(t,a){var n=t.split("}");n.splice(n.length-1,1);var o={};n[0].split(",").forEach(function(t,e){var a=t.split("=");o[a[0].trim()]=a[1]}),e.push(o)}),e},initWebSocket:function(){this.websock=new WebSocket(D.a.mapSocket+"/"+Object(k.a)()),this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onmessage=this.websocketonmessage,this.websock.onclose=this.websocketclose},websocketonopen:function(){},websocketonerror:function(t){},websocketonmessage:function(t){var e=this.transWebsocketFn(t.data);this.deviceDetailData=e},websocketclose:function(t){}},created:function(){},mounted:function(){this.getDataFn(),this.initWebSocket()},beforeDestroy:function(){this.websock.close()}},b={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"check_manage_wrap"},[a("div",{staticClass:"hover_animat custom_bg_color_white"},[a("div",{staticClass:"row_box"},[a("h2",{staticClass:"row_title"},[t._v("按条件筛选")]),t._v(" "),a("div",{staticClass:"form_wrap"},[a("div",{staticClass:"form_item"},[a("Row",{attrs:{gutter:20}},[a("Col",{attrs:{span:"6"}},[a("h3",[t._v("资产编号")]),t._v(" "),a("Input",{attrs:{placeholder:"资产编号"},model:{value:t.queryData.assetID,callback:function(e){t.$set(t.queryData,"assetID",e)},expression:"queryData.assetID"}})],1),t._v(" "),a("Col",{attrs:{span:"6"}},[a("h3",[t._v("资产名称")]),t._v(" "),a("Input",{attrs:{placeholder:"资产名称"},model:{value:t.queryData.assetName,callback:function(e){t.$set(t.queryData,"assetName",e)},expression:"queryData.assetName"}})],1),t._v(" "),a("Col",{attrs:{span:"6"}},[a("h3",[t._v("部门名称")]),t._v(" "),a("AutoComplete",{staticStyle:{width:"100%"},attrs:{placeholder:"部门名称"},on:{"on-focus":function(e){return t.inputFocusFn("departmentroom")},"on-blur":t.inputBlurFn,"on-search":t.handleSearchFn},model:{value:t.queryData.memorydepart,callback:function(e){t.$set(t.queryData,"memorydepart",e)},expression:"queryData.memorydepart"}},t._l(t.inputData,function(e){return a("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}),1)],1),t._v(" "),a("Col",{attrs:{span:"6"}},[a("h3",[t._v("所在科室名称")]),t._v(" "),a("AutoComplete",{staticStyle:{width:"100%"},attrs:{placeholder:"所在科室名称"},on:{"on-focus":function(e){return t.inputFocusFn("locDept")},"on-blur":t.inputBlurFn,"on-search":t.handleSearchFn},model:{value:t.queryData.memorylocDept,callback:function(e){t.$set(t.queryData,"memorylocDept",e)},expression:"queryData.memorylocDept"}},t._l(t.inputData,function(e){return a("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}),1)],1)],1)],1)]),t._v(" "),a("div",{staticClass:"submit_btn_wrap"},[a("Button",{attrs:{type:"primary",shape:"circle"},on:{click:t.searchAssetsFn}},[t._v("搜索")]),t._v(" "),a("Button",{attrs:{type:"error",shape:"circle"},on:{click:t.clearAssetsFn}},[t._v("清空")])],1)])]),t._v(" "),a("div",{staticClass:"row_wrap"},[a("div",{staticClass:"row_box hover_animat custom_bg_color_white"},[a("h2",{staticClass:"row_title"},[t._v("盘点明细表")]),t._v(" "),a("div",{staticClass:"data_table_top clearfix"},[a("div",{staticClass:"data_table_top_left"},[a("Button",{attrs:{type:"primary",shape:"circle",icon:"md-contrast"},on:{click:t.checkFn}},[t._v("立即盘点")])],1),t._v(" "),a("div",{staticClass:"data_table_top_right"},[a("div",{staticClass:"pagination_wrap"},[a("Page",{attrs:{"show-elevator":"","show-total":"","show-sizer":"",total:t.totalCount,"page-size-opts":t.pageSizeOptions,current:t.currentPage,"page-size":t.pageSize},on:{"on-change":t.changePageFn,"on-page-size-change":t.changePageSizeFn}})],1)])]),t._v(" "),a("div",{staticClass:"table_scroll_wrap"},[a("Table",{staticStyle:{"min-width":"1500px"},attrs:{stripe:"",columns:t.assetsDetailColumn,data:t.assetsDetailData,size:"large",loading:t.tableLoading},on:{"on-selection-change":t.checkAllGroupChange},scopedSlots:t._u([{key:"check",fn:function(e){var n=e.row;return[a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(n.check?n.check:"--"))])]}},{key:"status",fn:function(e){var n=e.row;return["正常"===n.status?a("Tag",{attrs:{color:"success"}},[a("span",[t._v(t._s(n.status))])]):"在修"===n.status?a("Tag",{attrs:{color:"warning"}},[a("span",[t._v(t._s(n.status))])]):"已报废"===n.status?a("Tag",{attrs:{color:"error"}},[a("span",[t._v(t._s(n.status))])]):(n.status,a("Tag",{attrs:{color:"default"}},[a("span",[t._v(t._s(n.status))])]))]}}])})],1)])]),t._v(" "),a("Modal",{attrs:{title:"","footer-hide":!0,"mask-closable":!1,closable:!1,width:"360"},model:{value:t.uploadModal,callback:function(e){t.uploadModal=e},expression:"uploadModal"}},[a("div",{staticStyle:{"text-align":"center",padding:"20px 0"}},[t.achieveUpload||t.errorUpload?t._e():a("Spin",{attrs:{fix:""}},[a("Icon",{staticClass:"loding_icon",attrs:{type:"ios-loading",size:"18"}}),t._v(" "),a("div",[t._v("正在盘点")])],1),t._v(" "),t.achieveUpload?a("Spin",{staticStyle:{color:"#00ad19"},attrs:{fix:""}},[a("Icon",{attrs:{type:"ios-checkmark-circle",size:"18"}}),t._v(" "),a("div",[t._v("盘点成功")])],1):t._e(),t._v(" "),t.errorUpload?a("Spin",{staticStyle:{color:"#f72b2b"},attrs:{fix:""}},[a("Icon",{attrs:{type:"ios-close-circle",size:"18"}}),t._v(" "),a("div",[t._v("盘点失败")])],1):t._e()],1)])],1)},staticRenderFns:[]};var w=a("VU/8")(y,b,!1,function(t){a("Rrr1")},"data-v-56680e0d",null);e.default=w.exports},Rrr1:function(t,e){}});