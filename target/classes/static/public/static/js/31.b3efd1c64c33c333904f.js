webpackJsonp([31],{"4+RC":function(a,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=e("wdqF"),r=e("8sRp"),n=e("KxKW"),s=e("JtJ0"),i=e("HYs4"),c=e("NHTL"),l=e("yoLw"),m=e("NAz/"),d=e("a84E"),p=e("EMb8"),h=e("7+uW"),u=e("tpLV"),v=e("Gaqz"),f=e("wDsp"),y=e("zcOu");h.a.component("Icon",p.a),h.a.component("Row",d.a),h.a.component("Col",m.a),h.a.component("Table",l.a),h.a.component("Tag",c.a),h.a.component("Page",i.a),h.a.component("Input",s.a),h.a.component("Button",n.a),h.a.component("Modal",r.a),h.a.component("Spin",o.a);var _={name:"gateway_create",components:{},props:{},data:function(){return{showMap:!1,createData:{gatewaymac:"",ipaddress:"",floor:"11",department:"",location:"",gatewayfree:"1",gatewayload:"",mapx:"",mapy:"",cadMapRoomName:"",roomnumber:""},baseLayers:null,homeLayers:null,deviceMarkers:[],devicePopups:[],map:null,currentFloor:"11",zoomKey:null,uploadModal:!1,achieveUpload:!1,errorUpload:!1,currentRoom:{geoJson:null,layer:null},selectRoom:{}}},watch:{currentFloor:function(){this.createData.floor=this.currentFloor}},computed:{},methods:{initMapFn:function(){this.homeLayers=new L.featureGroup,this.baseLayers=new L.featureGroup,this.markers=[];var a=new L.Proj.CRS("EPSG:4549","+proj=tmerc +lat_0=0 +lon_0=120 +k=1 +x_0=500000 +y_0=0 +ellps=GRS80 +units=m +no_defs",{resolutions:[156367.7919628329,78183.89598141646,39091.94799070823,19545.973995354114,9772.986997677057,4886.4934988385285,2443.2467494192642,1221.6233747096321,610.8116873548161,305.40584367740803,152.70292183870401,76.35146091935201,38.175730459676004,19.087865229838002,9.543932614919001,4.7719663074595005,2.3859831537297502,1.1929915768648751,.5964957884324376,.2982478942162188]}),t=L.latLngBounds(L.latLng(-4.279435,140.075537),L.latLng(-5.438369,138.29733));this.map=L.map("mapID",{center:[-4.9002,139.2102],layers:[this.homeLayers,this.baseLayers],zoom:10,maxZoom:14,minZoom:10,attributionControl:!1,doubleClickZoom:!1,maxBounds:t,crs:a}),this.initBoundaryFn(u.baseData1),this.initHomeLayerFn(u.homeData11),this.switchFloorFn(),this.initZoomFn(),this.changeZoomFn()},initMarkerFn:function(a){this.removeDeviceMarkerFn(),this.createData.mapx="",this.createData.mapy="";var t=L.marker(a.latlng,{icon:L.icon({iconUrl:e("xnra"),iconSize:[20]})}).addTo(this.map);this.deviceMarkers.push(t),this.createData.mapx=a.latlng.lat.toFixed(6),this.createData.mapy=a.latlng.lng.toFixed(6)},initZoomFn:function(){var a=this;this.map.addEventListener("zoomend",function(t){a.changeZoomFn()})},changeZoomFn:function(){var a=document.getElementsByClassName("showNAME"),t=this.map.getZoom();if(t<11)for(var e=0;e<a.length;e++)a[e].style.display="none",a[e].parentNode.style.display="none";else for(var o=0;o<a.length;o++)a[o].style.display="block",a[o].parentNode.style.display="block",a[o].style.fontSize=t+2+"px"},initBoundaryFn:function(a){L.Proj.geoJson(a,{style:function(a){return{color:"#ddd",weight:5,opacity:1,fillOpacity:1}}}).addTo(this.baseLayers)},createRoomFn:function(a,t){var e=this,o=L.Proj.geoJson(a,{style:function(a){return{color:"#fff",opacity:1,weight:2,fillColor:t,fillOpacity:1}}}).addTo(this.homeLayers),r=o.getBounds(),n=(r._northEast.lat-r._southWest.lat)/2+r._southWest.lat,s=(r._northEast.lng-r._southWest.lng)/2+r._southWest.lng,i='<div class="showNAME">'+a.properties.NAME+"</div>";L.marker([n,s],{icon:L.divIcon({className:"leaflet-echart-icon",html:i}),pro:a.properties}).addTo(this.homeLayers);o.addEventListener("click",function(a){e.initMarkerFn(a),e.currentRoom.layer&&e.currentRoom.geoJson&&e.currentRoom.geoJson.resetStyle(e.currentRoom.layer),e.currentRoom.layer=a.layer,e.currentRoom.geoJson=o,e.selectRoom=a.layer.feature.properties,e.createData.cadMapRoomName=e.selectRoom.NAME,e.createData.roomnumber=e.selectRoom.NO,o.setStyle({color:"#FFFFFF",opacity:1,weight:2,fillColor:"#ffd100",fillOpacity:1})})},initHomeLayerFn:function(a){var t=this;L.Proj.geoJson(a,{onEachFeature:function(a){a.crs={type:"name",properties:{name:"EPSG:4549"}};var e=t.initColorFn(a.properties.TYPE);t.createRoomFn(a,e)}})},initColorFn:function(a){return a?["#f7f0c5","#f7bbdf","#aeccfd","#88c7f9","#c3efc0","#c9b8ff","#ccc"][a-1]:"#ddd"},switchFloorFn:function(){var a=this;document.getElementById("moniterItem").addEventListener("click",function(t){if("li"===t.target.tagName.toLowerCase()){var e=t.target.getAttribute("data-value");if(e!==a.currentFloor){for(var o=document.getElementById("moniterItem").getElementsByTagName("li"),r=0;r<o.length;r++)o[r].classList.remove("active");t.target.classList.add("active");var n=null,s=null;switch(e){case"11":n=u.baseData1,s=u.homeData11;break;case"12":n=u.baseData1,s=u.homeData12;break;case"13":n=u.baseData1,s=u.homeData13;break;case"b1":n=u.baseData2,s=u.homeDataB1;break;case"b2":n=u.baseData3,s=u.homeDataB2;break;case"t1":n=u.baseData4,s=u.homeDataT1}a.currentFloor=e,a.clearAllDataFn(),a.initBoundaryFn(n),a.initHomeLayerFn(s),a.changeZoomFn()}}})},removeDeviceMarkerFn:function(){for(var a=0;a<this.deviceMarkers.length;a++)this.map.removeLayer(this.deviceMarkers[a]);for(var t=0;t<this.devicePopups.length;t++)this.map.removeLayer(this.devicePopups[t]);this.devicePopups=[],this.deviceMarkers=[]},removeRoomFn:function(){this.homeLayers.clearLayers()},removeBoundaryFn:function(){this.baseLayers.clearLayers()},clearAllDataFn:function(){this.removeBoundaryFn(),this.removeRoomFn(),this.removeDeviceMarkerFn(),this.createData.mapx="",this.createData.mapy="",this.createData.cadMapRoomName="",this.createData.roomnumber=""},initData:function(){switch(this.clearAllDataFn(),this.currentFloor){case"11":this.initBoundaryFn(u.baseData1),this.initHomeLayerFn(u.homeData11);break;case"12":this.initBoundaryFn(u.baseData1),this.initHomeLayerFn(u.homeData12);break;case"13":this.initBoundaryFn(u.baseData1),this.initHomeLayerFn(u.homeData13);break;case"b1":this.initBoundaryFn(u.baseData2),this.initHomeLayerFn(u.homeDataB1);break;case"b2":this.initBoundaryFn(u.baseData3),this.initHomeLayerFn(u.homeDataB2);break;case"t1":this.initBoundaryFn(u.baseData4),this.initHomeLayerFn(u.homeDataT1)}this.changeZoomFn(),this.createData={gatewaymac:"",ipaddress:"",floor:this.currentFloor,department:"",location:"",gatewayfree:"1",gatewayload:"",mapx:"",mapy:"",cadMapRoomName:"",roomnumber:""}},successFn:function(){var a=this;this.achieveUpload=!0,setTimeout(function(){a.uploadModal=!1,a.initData(),setTimeout(function(){a.achieveUpload=!1,a.errorUpload=!1},500)},1e3)},errorFn:function(){var a=this;this.errorUpload=!0,setTimeout(function(){a.uploadModal=!1,setTimeout(function(){a.achieveUpload=!1,a.errorUpload=!1},500)},1e3)},createFn:function(){var a=this;if(""===this.createData.gatewaymac.trim()||""===this.createData.floor||""===this.createData.mapx||""===this.createData.mapy||""===this.createData.location.trim()||""===this.createData.cadMapRoomName||""===this.createData.roomnumber)this.$Modal.error({title:"错误",content:"请输入完整信息！"});else{this.uploadModal=!0;var t={gatewaymac:Object(y.a)(this.createData.gatewaymac.trim()),ipaddress:this.createData.ipaddress.trim(),floor:this.createData.floor,department:this.createData.department.trim(),location:this.createData.location.trim(),gatewayfree:this.createData.gatewayfree,gatewayload:this.createData.gatewayload,mapx:this.createData.mapx,mapy:this.createData.mapy,cadMapRoomName:this.createData.cadMapRoomName.trim(),roomnumber:this.createData.roomnumber};this.$axios.post(f.a.gatewayCreate,t).then(function(t){0===t.data.code?a.successFn():(a.errorFn(),a.$Message.error({content:t.data.msg,duration:2}))}).catch(function(t){a.errorFn()})}}},created:function(){},mounted:function(){var a=this;this.$nextTick(function(){Object(v.b)().then(function(){Object(v.e)().then(function(){Object(v.f)().then(function(){a.showMap=!0,a.$nextTick(function(){a.initMapFn()})})})})})}},D={render:function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"gateway_create_wrap"},[e("div",{staticClass:"row_box hover_animat custom_bg_color_white"},[e("h2",{staticClass:"row_title"},[a._v("地图")]),a._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!a.showMap,expression:"!showMap"}],staticClass:"map_loading_notice"},[e("h3",[a._v("地图加载中...")])]),a._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:a.showMap,expression:"showMap"}],attrs:{id:"mapID"}},[a._m(0)])]),a._v(" "),e("div",{staticClass:"row_wrap hover_animat custom_bg_color_white"},[e("div",{staticClass:"row_box"},[a._m(1),a._v(" "),e("div",{staticClass:"form_wrap"},[e("div",{staticClass:"form_item"},[e("Row",{attrs:{gutter:20}},[e("Col",{attrs:{span:"6"}},[e("h3",[a._v("网关mac地址")]),a._v(" "),e("Input",{attrs:{placeholder:"mac地址（格式:ac233fa031fa）"},model:{value:a.createData.gatewaymac,callback:function(t){a.$set(a.createData,"gatewaymac",t)},expression:"createData.gatewaymac"}})],1),a._v(" "),e("Col",{attrs:{span:"6"}},[e("h3",[a._v("IP地址（可不填）")]),a._v(" "),e("Input",{attrs:{placeholder:"输入IP地址"},model:{value:a.createData.ipaddress,callback:function(t){a.$set(a.createData,"ipaddress",t)},expression:"createData.ipaddress"}})],1),a._v(" "),e("Col",{attrs:{span:"6"}},[e("h3",[a._v("所属科室")]),a._v(" "),e("Input",{attrs:{placeholder:"输入所属科室"},model:{value:a.createData.department,callback:function(t){a.$set(a.createData,"department",t)},expression:"createData.department"}})],1),a._v(" "),e("Col",{attrs:{span:"6"}},[e("h3",[a._v("所处位置")]),a._v(" "),e("Input",{attrs:{placeholder:"输入所处位置"},model:{value:a.createData.location,callback:function(t){a.$set(a.createData,"location",t)},expression:"createData.location"}})],1)],1)],1),a._v(" "),e("div",{staticClass:"form_item"},[e("Row",{attrs:{gutter:20}},[e("Col",{attrs:{span:"6"}},[e("h3",[a._v("房间名")]),a._v(" "),e("Input",{attrs:{disabled:""},model:{value:a.createData.cadMapRoomName,callback:function(t){a.$set(a.createData,"cadMapRoomName",t)},expression:"createData.cadMapRoomName"}})],1),a._v(" "),e("Col",{attrs:{span:"6"}},[e("h3",[a._v("所在楼层")]),a._v(" "),e("Input",{attrs:{disabled:""},model:{value:a.createData.floor,callback:function(t){a.$set(a.createData,"floor",t)},expression:"createData.floor"}})],1),a._v(" "),e("Col",{attrs:{span:"6"}},[e("h3",[a._v("坐标位置x")]),a._v(" "),e("Input",{attrs:{disabled:""},model:{value:a.createData.mapx,callback:function(t){a.$set(a.createData,"mapx",t)},expression:"createData.mapx"}})],1),a._v(" "),e("Col",{attrs:{span:"6"}},[e("h3",[a._v("坐标位置y")]),a._v(" "),e("Input",{attrs:{disabled:""},model:{value:a.createData.mapy,callback:function(t){a.$set(a.createData,"mapy",t)},expression:"createData.mapy"}})],1)],1)],1),a._v(" "),e("div",{staticClass:"form_item"},[e("Row",{attrs:{gutter:20}},[e("Col",{attrs:{span:"6"}},[e("h3",[a._v("房间编号")]),a._v(" "),e("Input",{attrs:{disabled:""},model:{value:a.createData.roomnumber,callback:function(t){a.$set(a.createData,"roomnumber",t)},expression:"createData.roomnumber"}})],1)],1)],1)]),a._v(" "),e("div",{staticClass:"submit_btn_wrap"},[e("Button",{attrs:{type:"primary",shape:"circle"},on:{click:a.createFn}},[a._v("确定新增")])],1)])]),a._v(" "),e("Modal",{attrs:{title:"","footer-hide":!0,"mask-closable":!1,closable:!1,width:"360"},model:{value:a.uploadModal,callback:function(t){a.uploadModal=t},expression:"uploadModal"}},[e("div",{staticStyle:{"text-align":"center",padding:"20px 0"}},[a.achieveUpload||a.errorUpload?a._e():e("Spin",{attrs:{fix:""}},[e("Icon",{staticClass:"loding_icon",attrs:{type:"ios-loading",size:"18"}}),a._v(" "),e("div",[a._v("正在保存")])],1),a._v(" "),a.achieveUpload?e("Spin",{staticStyle:{color:"#00ad19"},attrs:{fix:""}},[e("Icon",{attrs:{type:"ios-checkmark-circle",size:"18"}}),a._v(" "),e("div",[a._v("保存成功")])],1):a._e(),a._v(" "),a.errorUpload?e("Spin",{staticStyle:{color:"#f72b2b"},attrs:{fix:""}},[e("Icon",{attrs:{type:"ios-close-circle",size:"18"}}),a._v(" "),e("div",[a._v("保存失败")])],1):a._e()],1)])],1)},staticRenderFns:[function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{attrs:{id:"moniter"}},[e("ul",[e("li",{staticClass:"title"},[a._v("楼层选择")])]),a._v(" "),e("ul",{attrs:{id:"moniterItem"}},[e("li",{staticClass:"active",attrs:{"data-value":"11"}},[a._v("十一层")]),a._v(" "),e("li",{attrs:{"data-value":"12"}},[a._v("十二层")]),a._v(" "),e("li",{attrs:{"data-value":"13"}},[a._v("十三层")]),a._v(" "),e("li",{attrs:{"data-value":"b1"}},[a._v("医工科")]),a._v(" "),e("li",{attrs:{"data-value":"b2"}},[a._v("报废库")]),a._v(" "),e("li",{attrs:{"data-value":"t1"}},[a._v("办公室")])])])},function(){var a=this.$createElement,t=this._self._c||a;return t("h2",{staticClass:"row_title"},[this._v("网关信息"),t("span",{staticStyle:{"font-size":"14px"}},[this._v("（在地图上选择点位后会自动填充位置信息到下方输入框中）")])])}]};var b=e("VU/8")(_,D,!1,function(a){e("CK6n")},"data-v-64fa8e0b",null);t.default=b.exports},CK6n:function(a,t){}});