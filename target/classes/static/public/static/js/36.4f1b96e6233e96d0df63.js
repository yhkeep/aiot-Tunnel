webpackJsonp([36],{"7Rge":function(t,e){},PmD9:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("Fd2+"),i=(a("jgNZ"),a("dKGA"),a("FDxC"),a("2PSJ"),a("uTM9"),a("9ULi"),a("jydU"),a("wvM5"),a("tLo2"),a("Rv11"),a("UEU1"),a("wDsp")),n=a("TIfe"),o=a("/WQG"),r={name:"mobile_temp_manage",components:{Button:s.b,Row:s.v,Col:s.g,Tag:s.y,Loading:s.o,Search:s.w,Icon:s.m,Field:s.l,Popup:s.t,Picker:s.s,Pagination:s.r},props:{},data:function(){return{warningDialogShow:!1,typeDialogShow:!1,tempDetailData:[],tempDetailDataNow:[],warning:[],queryData:{freezernumber:"",mac:"",freezername:"",department:"",type:""},instrumentType:o.a,value:"",showSearchPane:!1,loadingShow:!0,websock:null,showPagination:!1,currentPage:1,totalCount:0}},watch:{},computed:{},methods:{getDetailFn:function(){var t=this;this.$axios.get(i.a.tempHistory+"?currentPage="+this.currentPage).then(function(e){var a=e.data,s=Number(a.pop().total);t.totalCount=s,t.tempDetailData=a}).catch(function(t){})},changePageFn:function(){this.getDetailFn()},getTypeFn:function(t){this.queryData.type=t.key,this.typeDialogShow=!1},showMoreMenuFn:function(){this.$emit("getMessage",!0)},openSearchPaneFn:function(){this.showSearchPane=!0},toTempDetailFn:function(t){this.$router.push({path:"/mobile/temp_detail/"+t})},toTempEditFn:function(t){this.$router.push({path:"/mobile/temp_edit/"+t})},toCreateFn:function(){this.$router.push({path:"/mobile/temp_create"})},initWebSocket:function(){this.websock=new WebSocket(i.a.tempDetailSocket+"/"+Object(n.a)()),this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onmessage=this.websocketonmessage,this.websock.onclose=this.websocketclose},websocketonmessage:function(t){if(t.data){var e=JSON.parse(t.data);this.filterTempFn(e)}},searchFn:function(){var t=this,e={},a=0;for(var s in this.queryData)this.queryData[s]&&this.queryData[s].trim()&&(e[s]=this.queryData[s].trim(),a++);if(this.tempDetailDataNow=[],this.warning=[],0===a)this.getDataFn();else if(1===a){var i=function(a){var s=new RegExp(e[a].trim());t.tempDetailData.forEach(function(e,i){e[a].trim().match(s)&&t.tempDetailDataNow.push(e)})};for(var n in e)i(n)}else if(2===a){var o=new RegExp(e.freezername.trim()),r=new RegExp(e.department.trim());this.tempDetailData.forEach(function(e,a){e.freezername.trim().match(o)&&e.department.trim().match(r)&&t.tempDetailDataNow.push(e)})}this.showSearchPane=!1},clearAssetsFn:function(){for(var t in this.queryData)this.queryData[t]=""},filterTempFn:function(t){var e=this;this.warning=[],this.tempDetailDataNow.forEach(function(a,s){t.forEach(function(t,s){a.mac===t.mac&&(a.warningType=[],a.temp=t.temperature?Number(Number(t.temperature).toFixed(2)):"",a.humi=t.humidity?Number(Number(t.humidity).toFixed(2)):"",a.topTemp=t.toptemperature?Number(Number(t.toptemperature).toFixed(2)):"",a.topHum=t.tophumidity?Number(Number(t.tophumidity).toFixed(2)):"",a.bottomTemp=t.mintemperature?Number(Number(t.mintemperature).toFixed(2)):"",a.bottomHum=t.minhumidity?Number(Number(t.minhumidity).toFixed(2)):"",a.electric=t.electric?t.electric:"",a.temp&&(a.tempRange[0]&&a.temp<a.tempRange[0]&&a.warningType.push("temp"),a.tempRange[1]&&a.temp>a.tempRange[1]&&a.warningType.push("temp")),a.humi&&(a.humRange[0]&&a.humi<a.humRange[0]&&a.warningType.push("humi"),a.humRange[1]&&a.humi>a.humRange[1]&&a.warningType.push("humi")),a.warningType.length>0&&e.warning.push(a))})})},getDataFn:function(t){var e=this;this.loadingShow=!0,this.tempDetailData=[],this.$axios.get(i.a.tempQuery).then(function(t){t.data.forEach(function(t,a){var s={freezername:t.freezername?t.freezername:"--",freezernumber:t.freezernumber?t.freezernumber:"--",location:t.location?t.location:"--",department:t.department?t.department:"--",type:t.type?t.type:"--",mac:t.mac?t.mac:"--",electric:"",temp:"",humi:"",topTemp:"",bottomTemp:"",topHum:"",bottomHum:"",warningType:[],tempRange:[t.temperaturefitted?Number(t.temperaturefitted.split("~")[0]):"",t.temperaturefitted?Number(t.temperaturefitted.split("~")[1]):""],humRange:[t.humidityfitted?Number(t.humidityfitted.split("~")[0]):"",t.humidityfitted?Number(t.humidityfitted.split("~")[1]):""]};e.tempDetailData.push(s)}),e.tempDetailDataNow=e.tempDetailData,e.loadingShow=!1}).catch(function(t){})}},created:function(){this.getDataFn(),this.initWebSocket()},mounted:function(){},beforeDestroy:function(){this.websock.close()}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mobile_temp_manage_wrap manage_list_wrap custom_flex_column_wrap"},[a("div",{staticClass:"mobile_search_box"},[a("div",{staticClass:"mobile_search_box_left"},[a("Search",{attrs:{disabled:"",placeholder:"点击展开搜索面板",shape:"round"},on:{click:t.openSearchPaneFn},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1),t._v(" "),a("div",{staticClass:"mobile_search_box_right"},[a("div",{staticClass:"mobile_search_box_right_tools temp_notice_icon",staticStyle:{width:"60px"}},[a("Icon",{attrs:{name:"volume-o"},on:{click:function(e){t.warningDialogShow=!0}}}),t._v(" "),a("span",{class:t.warning.length?"right_dot_notice error":"right_dot_notice success"},[t._v(t._s(t.warning.length>99?"99+":t.warning.length))])],1),t._v(" "),a("div",{staticClass:"mobile_search_box_right_tools",staticStyle:{width:"40px"}},[a("Icon",{attrs:{name:"add-o"},on:{click:t.toCreateFn}})],1),t._v(" "),a("div",{staticClass:"mobile_search_box_right_tools",staticStyle:{width:"40px"}},[a("Icon",{attrs:{name:"bars"},on:{click:t.showMoreMenuFn}})],1)])]),t._v(" "),a("div",{staticClass:"assets_table_wrap"},[a("div",{staticClass:"assets_table_wrap_content  clearfix"},[a("div",{staticClass:"assets_table_wrap_left"},[a("ul",{staticClass:"assets_table_ul"},[t._m(0),t._v(" "),t._l(t.tempDetailDataNow,function(e,s){return a("li",{key:s,staticClass:"assets_table_li"},[a("div",{staticClass:"assets_table_item"},[a("p",[t._v(t._s(s+1))])])])})],2)]),t._v(" "),a("div",{staticClass:"assets_table_wrap_right"},[a("ul",{staticClass:"assets_table_ul"},[t._m(1),t._v(" "),t._l(t.tempDetailDataNow,function(e,s){return a("li",{key:s,staticClass:"assets_table_li clearfix"},[a("div",{staticClass:"assets_table_item"},[a("p",[t._v("\n                                 "+t._s(e.freezernumber?e.freezernumber:"--")+"\n                             ")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("\n                                  "+t._s(e.freezername?e.freezername:"--")+" \n                             ")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("\n                                  "+t._s(e.temp?e.temp+"℃":"--")+"\n                             ")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("\n                                  "+t._s(e.humi?e.humi+"%":"--")+"\n                             ")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("\n                                  "+t._s(e.topTemp?e.topTemp+"℃":"--")+"\n                              ")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("\n                                  "+t._s(e.bottomTemp?e.bottomTemp+"℃":"--")+"\n                              ")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("\n                                  "+t._s(e.topHum?e.topHum+"%":"--")+"\n                              ")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("\n                                  "+t._s(e.bottomHum?e.bottomHum+"%":"--")+"\n                              ")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("\n                                  "+t._s(e.electric?e.electric:"--")+"\n                              ")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("\n                                  "+t._s(e.mac?e.mac:"--")+"\n                             ")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("\n                                  "+t._s(e.type?e.type:"--")+"\n                             ")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("\n                                  "+t._s(e.location?e.location:"--")+"\n                             ")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("Button",{attrs:{round:"",size:"small"},on:{click:function(a){return t.toTempDetailFn(e.mac)}}},[t._v("查看")]),t._v(" "),a("Button",{attrs:{round:"",size:"small"},on:{click:function(a){return t.toTempEditFn(e.mac)}}},[t._v("编辑")])],1)])})],2)])]),t._v(" "),a("div",{staticClass:"loading_info_wrap"},[a("Pagination",{directives:[{name:"show",rawName:"v-show",value:t.showPagination&&t.tempDetailDataNow.length,expression:"showPagination&&tempDetailDataNow.length"}],attrs:{"total-items":t.totalCount,"show-page-size":2,"prev-text":"上一页","next-text":"下一页","force-ellipses":"",mode:"simple"},on:{change:t.changePageFn},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}}),t._v(" "),a("Loading",{directives:[{name:"show",rawName:"v-show",value:t.loadingShow,expression:"loadingShow"}],attrs:{size:"24px"}},[t._v("加载中...")]),t._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:!t.loadingShow&&!t.tempDetailDataNow.length,expression:"!loadingShow&&!tempDetailDataNow.length"}]},[t._v("暂无数据")])],1)]),t._v(" "),a("Popup",{attrs:{position:"top",round:""},model:{value:t.showSearchPane,callback:function(e){t.showSearchPane=e},expression:"showSearchPane"}},[a("div",{staticClass:"query_data_wrap"},[a("div",{staticClass:"query_data_box"},[a("Field",{attrs:{clearable:"",label:"仪器编号",placeholder:"请输入要查询的仪器编号"},model:{value:t.queryData.freezernumber,callback:function(e){t.$set(t.queryData,"freezernumber",e)},expression:"queryData.freezernumber"}}),t._v(" "),a("Field",{attrs:{clearable:"",label:"仪器名称",placeholder:"请输入要查询的仪器名称"},model:{value:t.queryData.freezername,callback:function(e){t.$set(t.queryData,"freezername",e)},expression:"queryData.freezername"}}),t._v(" "),a("Field",{attrs:{clearable:"",label:"mac地址",placeholder:"请输入要查询的mac地址"},model:{value:t.queryData.mac,callback:function(e){t.$set(t.queryData,"mac",e)},expression:"queryData.mac"}}),t._v(" "),a("Field",{attrs:{clearable:"",label:"所在部门",placeholder:"请输入要查询的所在部门"},model:{value:t.queryData.department,callback:function(e){t.$set(t.queryData,"department",e)},expression:"queryData.department"}}),t._v(" "),a("Field",{attrs:{clearable:"",disabled:"",label:"仪器类型",placeholder:"请选择要查询的仪器类型"},on:{click:function(e){t.typeDialogShow=!0}},model:{value:t.queryData.type,callback:function(e){t.$set(t.queryData,"type",e)},expression:"queryData.type"}})],1),t._v(" "),a("div",{staticClass:"tools_button_wrap"},[a("Button",{staticClass:"tools_button",attrs:{color:"linear-gradient(to right, #ff6034, #ee0a24)",round:""},on:{click:t.clearAssetsFn}},[t._v("清空")]),t._v(" "),a("Button",{staticClass:"tools_button",attrs:{color:"linear-gradient(to right, #69aff5, #1989fa)",round:""},on:{click:t.searchFn}},[t._v("搜索")])],1)])]),t._v(" "),a("Popup",{attrs:{position:"bottom"},model:{value:t.typeDialogShow,callback:function(e){t.typeDialogShow=e},expression:"typeDialogShow"}},[a("Picker",{attrs:{columns:t.instrumentType,"show-toolbar":"",title:"请选择类型","visible-item-count":5},on:{cancel:function(e){t.typeDialogShow=!1},confirm:t.getTypeFn}})],1),t._v(" "),a("Popup",{staticClass:"warning_wrap",style:{width:"70%",height:"100%"},attrs:{position:"right"},model:{value:t.warningDialogShow,callback:function(e){t.warningDialogShow=e},expression:"warningDialogShow"}},[a("div",{staticClass:"temp_warning_title"},[a("h2",[t._v("温湿度异常一览")])]),t._v(" "),t._l(t.warning,function(e,s){return t.warning?a("ul",[a("li",{staticClass:"warning_li"},[a("p",[t._v(t._s(s+1)+" - "+t._s(e.department)+" - "+t._s(e.freezername))]),t._v(" "),a("p",[t._v("温度："),a("span",{class:e.warningType.find(function(t){return"temp"===t})?"warning_imp":""},[t._v(t._s(e.temp)+"℃")]),t._v("，湿度："),a("span",{class:e.warningType.find(function(t){return"humi"===t})?"warning_imp":""},[t._v(t._s(e.humi)+"%")])]),t._v(" "),a("p",[t._v("温度范围："+t._s(e.tempRange[0])+" ~ "+t._s(e.tempRange[1])+"，湿度范围："+t._s(e.humRange[0])+" ~ "+t._s(e.humRange[1]))]),t._v(" "),a("p",{staticStyle:{color:"#979797"}})])]):t._e()}),t._v(" "),t.warning&&0===t.warning.length?a("p",{staticClass:"warning_notice"},[t._v("暂未发现异常数据!")]):t._e()],2)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("li",{staticClass:"assets_table_li assets_table_li_name"},[e("div",{staticClass:"assets_table_item"},[e("p",[this._v("序号")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("li",{staticClass:"assets_table_li assets_table_li_name clearfix"},[a("div",{staticClass:"assets_table_item"},[a("p",[t._v("编号")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("名称")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("温度（℃）")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("湿度（%）")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("今日最高温度（℃）")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("今日最低温度（℃）")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("今日最高湿度（%）")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("今日最低湿度（%）")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("电量（%）")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("mac")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("类型")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("位置")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("操作")])])])}]};var c=a("VU/8")(r,l,!1,function(t){a("7Rge")},"data-v-37a919af",null);e.default=c.exports}});