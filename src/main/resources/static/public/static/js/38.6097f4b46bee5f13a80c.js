webpackJsonp([38],{"2x8O":function(t,e){},KtcL:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("mvHQ"),n=a.n(o),i=a("wdqF"),s=a("8sRp"),r=a("KxKW"),c=a("JtJ0"),l=a("HYs4"),u=a("X2sI"),d=a("LuSo"),h=a("9N2q"),g=a("NHTL"),m=a("yoLw"),p=a("NAz/"),f=a("a84E"),y=a("EMb8"),w=a("7+uW"),v=[{value:"11",label:"十一层"},{value:"12",label:"十二层"},{value:"13",label:"十三层"},{value:"b1",label:"医工科"},{value:"b2",label:"报废库"}],_=a("wDsp");w.a.component("Icon",y.a),w.a.component("Row",f.a),w.a.component("Col",p.a),w.a.component("Table",m.a),w.a.component("Tag",g.a),w.a.component("DatePicker",h.a),w.a.component("Select",d.a),w.a.component("Option",u.a),w.a.component("Page",l.a),w.a.component("Input",c.a),w.a.component("Button",r.a),w.a.component("Modal",s.a),w.a.component("Spin",i.a);var D={name:"gateway_manage",components:{},props:{},data:function(){return{queryData:{gatewaymac:""},floor:"13",tableLoading:!0,floorData:v,gatewayDetailColumn:[{title:"选择",slot:"selection",type:"selection",width:100},{title:"网关mac地址",key:"gatewaymac",slot:"gatewaymac"},{title:"坐落位置",key:"location"},{title:"楼层",key:"floor"},{title:"房间名",key:"cadMapRoomName"},{title:"状态",key:"status",slot:"status",width:100},{title:"更新时间",key:"updatetime"},{title:"操作",key:"operation",slot:"operation",width:200}],gatewayDetailData:[],gatewayDetailDataNow:[],selection:[],deleteModal:!1,achieveDelete:!1,errorDelete:!1,totalCount:0,currentPage:1,pageSize:10}},watch:{},computed:{},methods:{searchGatewayFn:function(){var t=this;this.gatewayDetailDataNow=[],this.queryData.gatewaymac.trim()?(this.gatewayDetailDataNow=[],this.gatewayDetailData.forEach(function(e,a){e.gatewaymac===t.queryData.gatewaymac.trim()&&t.gatewayDetailDataNow.push(e)})):this.getDataFn()},clearGatewayFn:function(){for(var t in this.queryData)this.queryData[t]=""},checkAllGroupChange:function(t){this.selection=t},restartGatewayFn:function(){var t=this;if(!this.selection.length)return this.$Message.error({content:"请选择至少一项!",duration:2});var e=[],a=[];this.selection.forEach(function(t,o){"离线"===t.status?e.push(t):a.push(t)}),e.length&&a.length?this.$Modal.confirm({title:"重启提示",okText:"确定",cancelText:"取消",content:'<h2 style="color:#f94040">'+e.length+"个网关为离线状态无法重启！你确定要继续重启其它"+a.length+"个在线网关吗？</h2>",onOk:function(){for(var e="",o=0;o<a.length;o++)e+="gatewaymac="+a[o].gatewaymac+"&";t.$axios.post(_.a.gatewayRestart+e+"address="+t.$store.state.address).then(function(e){"ok"===e.data.msg?t.$Message.success({content:"成功发送重启请求！",duration:2}):t.$Message.error({content:"发送重启请求失败！",duration:2})}).catch(function(e){t.$Message.error({content:"发送重启请求失败！",duration:2})})}}):e.length&&!a.length?this.$Message.error({content:"发送重启请求失败！所选网关均为离线状态",duration:2}):!e.length&&a.length&&this.$Modal.confirm({title:"重启提示",okText:"确定",cancelText:"取消",content:'<h2 style="color:#f94040">你确定要重启这'+a.length+"个网关吗？</h2>",onOk:function(){for(var e="",o=0;o<a.length;o++)e+="gatewaymac="+a[o].gatewaymac+"&";t.$axios.post(_.a.gatewayRestart+e+"address="+t.$store.state.address).then(function(e){"ok"===e.data.msg?t.$Message.success({content:"成功发送重启请求！",duration:2}):t.$Message.error({content:"发送重启请求失败！",duration:2})}).catch(function(e){t.$Message.error({content:"发送重启请求失败！",duration:2})})}})},restartAllGatewayFn:function(){var t=this;this.$Modal.confirm({title:"重启提示",okText:"确定",cancelText:"取消",content:'<h2 style="color:#f94040">你确定要重启所有的网关吗？离线状态的网关将无法发送重启请求</h2>',onOk:function(){t.$axios.post(_.a.gatewayRestartAll+"address="+t.$store.state.address).then(function(e){"ok"===e.data.msg?t.$Message.success({content:"成功发送重启请求！",duration:2}):t.$Message.error({content:"发送重启请求失败！",duration:2})}).catch(function(e){t.$Message.error({content:"发送重启请求失败！",duration:2})})}})},restartThisGatewayFn:function(t){var e=this;"离线"===this.gatewayDetailData.find(function(e,a){return e.gatewaymac===t}).status?this.$Message.error({content:"发送重启请求失败！该网关为离线状态",duration:2}):this.$Modal.confirm({title:"重启提示",okText:"确定",cancelText:"取消",content:'<h2 style="color:#f94040">你确定要重启 '+t+" 这个网关吗？</h2>",onOk:function(){e.$axios.post(_.a.gatewayRestart+"gatewaymac="+t+"&address="+e.$store.state.address).then(function(t){"ok"===t.data.msg?e.$Message.success({content:"成功发送重启请求！",duration:2}):e.$Message.error({content:"发送重启请求失败！",duration:2})}).catch(function(t){e.$Message.error({content:"发送重启请求失败！",duration:2})})}})},successFn:function(){var t=this;this.achieveDelete=!0,setTimeout(function(){t.deleteModal=!1,t.currentPage=1,t.getDataFn(),setTimeout(function(){t.achieveDelete=!1,t.errorDelete=!1},500)},1e3)},errorFn:function(){var t=this;this.errorDelete=!0,setTimeout(function(){t.deleteModal=!1,setTimeout(function(){t.achieveDelete=!1,t.errorDelete=!1},500)},1e3)},filterFloorFn:function(t){var e=this;return t.filter(function(t,a){return t.floor===e.floor})},getDataFn:function(){var t=this;this.$Loading.start(),this.tableLoading=!0,this.gatewayDetailData=[],this.gatewayDetailDataNow=[],this.$axios.get(_.a.gatewayQuery+this.$store.state.address).then(function(e){e.data.forEach(function(e,a){if("{}"!==n()(e)&&""!==e.gatewaymac){var o={gatewaymac:e.gatewaymac,floor:e.floor?e.floor:"",ipaddress:e.ipaddress?e.ipaddress:"",mapx:e.mapx?e.mapx:"",mapy:e.mapy?e.mapy:"",department:e.department?e.department:"",location:e.location?e.location:"",status:"online"===e.online&&e.updatetime?"在线":"离线",updatetime:e.updatetime?e.updatetime:"",cadMapRoomName:e.cadMapRoomName?e.cadMapRoomName:"",roomnumber:e.roomnumber?e.roomnumber:""};t.gatewayDetailData.push(o)}}),t.gatewayDetailDataNow=t.filterFloorFn(t.gatewayDetailData),t.totalCount=t.gatewayDetailDataNow.length,t.tableLoading=!1,t.$Loading.finish()}).catch(function(e){t.$Loading.error()})},changePageFn:function(t){this.tableLoading=!0,this.currentPage=t,this.selection=[],this.getDataFn()},floorChangeFn:function(){this.selection=[],this.currentPage=1,this.getDataFn()},refreshFn:function(){this.selection=[],this.getDataFn()},settingGatewayFn:function(){this.$router.push({path:"/web/gateway_setting"})},toCreateFn:function(){this.$router.push({path:"/web/gateway_create"})},toDetailFn:function(t){this.gatewayDetailData.forEach(function(e,a){if(e.gatewaymac===t){var o={gatewaymac:e.gatewaymac,floor:e.floor,ipaddress:e.ipaddress,mapx:e.mapx,mapy:e.mapy,location:e.location?e.location:"",department:e.department?e.department:"",cadMapRoomName:e.cadMapRoomName,roomnumber:e.roomnumber};window.sessionStorage.setItem("detailData",n()(o))}}),this.$router.push({path:"/web/gateway_detail"})},deleteFn:function(){var t=this;if(!this.selection.length)return this.$Message.error({content:"请选择至少一项!",duration:2});this.$Modal.confirm({title:"删除提示",okText:"确定删除",cancelText:"取消",content:'<h2 style="color:#f94040">你确定要删除这'+this.selection.length+"个网关吗？</h2>",onOk:function(){t.deleteCertainFn()}})},deleteCertainFn:function(){this.deleteModal=!0;var t=[];this.selection.forEach(function(e,a){var o={gatewaymac:e.gatewaymac};t.push(o)}),this.deletePortFn(t)},deleteThisGatewayFn:function(t){var e=this;this.$Modal.confirm({title:"删除提示",okText:"确定删除",cancelText:"取消",content:'<h2 style="color:#f94040">你确定要删除 '+t+" 这个网关吗？</h2>",onOk:function(){e.deleteModal=!0;var a=[{gatewaymac:t}];e.deletePortFn(a)}})},deletePortFn:function(t){var e=this;this.$axios.post(_.a.gatewayDelete,t).then(function(t){"success"===t.data.msg?e.successFn():(e.errorFn(),e.$Message.error({content:t.data.msg,duration:2}))}).catch(function(t){e.errorFn()})}},created:function(){},mounted:function(){this.getDataFn()}},k={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"gateway_manage_wrap"},[a("div",{staticClass:"hover_animat custom_bg_color_white"},[a("div",{staticClass:"row_box"},[a("h2",{staticClass:"row_title"},[t._v("按条件筛选")]),t._v(" "),a("div",{staticClass:"form_wrap"},[a("div",{staticClass:"form_item"},[a("Row",{attrs:{gutter:20}},[a("Col",{attrs:{span:"24"}},[a("h3",[t._v("网关mac地址")]),t._v(" "),a("Input",{attrs:{placeholder:"网关mac地址"},model:{value:t.queryData.gatewaymac,callback:function(e){t.$set(t.queryData,"gatewaymac",e)},expression:"queryData.gatewaymac"}})],1)],1)],1)]),t._v(" "),a("div",{staticClass:"submit_btn_wrap"},[a("Button",{attrs:{type:"primary",shape:"circle"},on:{click:t.searchGatewayFn}},[t._v("搜索")]),t._v(" "),a("Button",{attrs:{type:"error",shape:"circle"},on:{click:t.clearGatewayFn}},[t._v("清空")])],1)])]),t._v(" "),a("div",{staticClass:"row_wrap hover_animat custom_bg_color_white"},[a("div",{staticClass:"row_box"},[a("h2",{staticClass:"row_title"},[t._v("网关明细表")]),t._v(" "),a("div",{staticClass:"data_table_top clearfix"},[a("div",{staticClass:"data_table_top_left"},[a("Button",{attrs:{type:"primary",shape:"circle",icon:"md-add"},on:{click:t.toCreateFn}},[t._v("新增网关")]),t._v(" "),a("Button",{attrs:{type:"error",shape:"circle",icon:"md-trash"},on:{click:t.deleteFn}},[t._v("批量删除网关")]),t._v(" "),a("Button",{attrs:{type:"warning",shape:"circle",icon:"md-power"},on:{click:t.restartGatewayFn}},[t._v("批量重启网关")]),t._v(" "),a("Button",{attrs:{type:"primary",shape:"circle",icon:"md-refresh-circle"},on:{click:t.restartAllGatewayFn}},[t._v("重启所有网关")]),t._v(" "),a("Button",{attrs:{type:"warning",shape:"circle",icon:"md-cog"},on:{click:t.settingGatewayFn}},[t._v("配置网关")])],1),t._v(" "),a("div",{staticClass:"data_table_top_right"}),t._v(" "),a("div",{staticClass:"data_table_top_center"},[a("div",{staticStyle:{display:"inline-block","margin-right":"10px"}},[a("Select",{on:{"on-change":t.floorChangeFn},model:{value:t.floor,callback:function(e){t.floor=e},expression:"floor"}},t._l(t.floorData,function(e){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1)],1),t._v(" "),a("Button",{attrs:{type:"success",shape:"circle",icon:"md-refresh-circle"},on:{click:t.refreshFn}},[t._v("刷新")])],1)]),t._v(" "),a("div",{staticClass:"table_scroll_wrap"},[a("Table",{staticStyle:{"min-width":"1000px"},attrs:{stripe:"",columns:t.gatewayDetailColumn,data:t.gatewayDetailDataNow,size:"large",loading:t.tableLoading},on:{"on-selection-change":t.checkAllGroupChange},scopedSlots:t._u([{key:"gatewaymac",fn:function(e){var o=e.row;return[a("a",{on:{click:function(e){return t.toDetailFn(o.gatewaymac)}}},[t._v(t._s(o.gatewaymac))])]}},{key:"operation",fn:function(e){var o=e.row;return[a("Button",{attrs:{type:"default",shape:"circle",icon:"md-power"},on:{click:function(e){return t.restartThisGatewayFn(o.gatewaymac)}}},[t._v("重启")]),t._v(" "),a("Button",{attrs:{type:"default",shape:"circle",icon:"md-trash"},on:{click:function(e){return t.deleteThisGatewayFn(o.gatewaymac)}}},[t._v("删除")])]}},{key:"status",fn:function(e){var o=e.row;return["在线"===o.status?a("Tag",{attrs:{color:"success"}},[t._v("在线")]):"离线"===o.status?a("Tag",{attrs:{color:"error"}},[t._v("离线")]):a("span",[t._v(t._s(o.status))])]}}])})],1)])]),t._v(" "),a("Modal",{attrs:{title:"","footer-hide":!0,"mask-closable":!1,closable:!1,width:"360"},model:{value:t.deleteModal,callback:function(e){t.deleteModal=e},expression:"deleteModal"}},[a("div",{staticStyle:{"text-align":"center",padding:"20px 0"}},[t.achieveDelete||t.errorDelete?t._e():a("Spin",{attrs:{fix:""}},[a("Icon",{staticClass:"loding_icon",attrs:{type:"ios-loading",size:"18"}}),t._v(" "),a("div",[t._v("正在删除")])],1),t._v(" "),t.achieveDelete?a("Spin",{staticStyle:{color:"#00ad19"},attrs:{fix:""}},[a("Icon",{attrs:{type:"ios-checkmark-circle",size:"18"}}),t._v(" "),a("div",[t._v("删除成功")])],1):t._e(),t._v(" "),t.errorDelete?a("Spin",{staticStyle:{color:"#f72b2b"},attrs:{fix:""}},[a("Icon",{attrs:{type:"ios-close-circle",size:"18"}}),t._v(" "),a("div",[t._v("删除失败")])],1):t._e()],1)])],1)},staticRenderFns:[]};var F=a("VU/8")(D,k,!1,function(t){a("2x8O")},"data-v-298830ec",null);e.default=F.exports}});