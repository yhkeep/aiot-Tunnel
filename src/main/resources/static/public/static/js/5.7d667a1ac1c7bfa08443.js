webpackJsonp([5],{"6NuU":function(t,e,a){a("XqYu")},"6d7H":function(t,e){},I40i:function(t,e){},Medb:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("Fd2+"),i=(a("jgNZ"),a("dKGA"),a("QP/A"),a("cnGM"),a("FDxC"),a("4T1P"),a("2PSJ"),a("d9cu"),a("OeKT"),a("6NuU"),a("MHRi"),a("GKy3"),a("uTM9"),a("UEU1"),a("wvM5"),a("wDsp")),n=a("TIfe"),o=(a("q29v"),{name:"mobile_check_manage",components:{Button:s.b,CellGroup:s.d,Cell:s.c,Row:s.u,Col:s.g,Tag:s.A,CheckboxGroup:s.f,Checkbox:s.e,Overlay:s.p,Dialog:s.i,Toast:s.B,Loading:s.m,Pagination:s.q,Field:s.j},props:{},data:function(){return{user:this.$store.state.user,currentPage:1,totalCount:0,hasMore:!0,checked:!0,assetsDetailData:[],deviceDetailData:[],checkedArr:[],showInfo:!1,editData:{},checkAll:!1,loadingShow:!0,showPagination:!1,queryData:{assetID:"",assetName:""}}},watch:{deviceDetailData:function(){var t=this;this.deviceDetailData.forEach(function(e,a){t.assetsDetailData.forEach(function(t,a){e.Mac===t.mac&&(t.location=e.Location)})})},checkAll:function(){!0===this.checkAll?(this.$refs.checkboxGroup.toggleAll(!0),console.log(this.checkedArr)):(this.$refs.checkboxGroup.toggleAll(),console.log(this.checkedArr))}},computed:{assetsDetailDataNow:function(){return this.assetsDetailData}},methods:{searchFn:function(){this.currentPage=1,this.assetsDetailData=[],this.checkedArr=[],this.checkAll=!1,this.totalCount=0,this.getDataFn()},checkAllFn:function(){this.$refs.checkboxGroup.toggleAll(!0)},checkFn:function(){var t=this,e=[];this.checkedArr.forEach(function(a,s){t.assetsDetailData.forEach(function(t,s){a===t.assetID&&e.push(t)})}),e.length?e.length>1?s.i.confirm({title:"盘点提示！",message:"你确定要同时盘点这"+e.length+"个资产吗？"}).then(function(){t.checkCertainFn(e)}).catch(function(){}):this.checkCertainFn(e):this.$notify({type:"warning",message:"请至少选择一个资产！",duration:2e3})},checkCertainFn:function(t){var e=this,a=[];t.forEach(function(t,e){var s={assetID:t.assetID.trim()};a.push(s)});var s=this.$toast.loading({message:"盘点中...",forbidClick:!0,duration:0});this.$axios.post(i.a.assetsCheck+"checkpep="+this.user,a).then(function(t){"success"===t.data.msg?(s.clear(),e.$toast.success("盘点成功！"),e.assetsDetailData=[],e.checkedArr=[],e.checkAll=!1,e.totalCount=0,e.getDataFn()):(s.clear(),e.$toast.fail("盘点失败！"))}).catch(function(t){s.clear(),e.$notify({type:"danger",message:t,duration:2e3})})},showInfoFn:function(t){this.editData={},this.editData=t,this.showInfo=!0},getDataFn:function(){var t=this;this.loadingShow=!0,this.assetsDetailData=[],this.$axios.post(i.a.assetsQuery+"?currentPage="+this.currentPage+"&assetName="+this.queryData.assetName+"&assetID="+this.queryData.assetID).then(function(e){for(var a=e.data,s=Number(a.pop().total),i=0;i<a.length;i++){for(var n in a[i])""!==a[i][n]&&"null"!==a[i][n]||(a[i][n]="--");t.assetsDetailData.push(a[i])}t.totalCount=s,t.loadingShow=!1,t.showPagination=!0}).catch(function(t){})},getMoreFn:function(){this.currentPage+=1,this.getDataFn()},changePageFn:function(){this.checkedArr=[],this.checkAll=!1,this.getDataFn()},transWebsocketFn:function(t){var e=[],a=t.split("{");return a.splice(0,1),a.forEach(function(t,a){var s=t.split("}");s.splice(s.length-1,1);var i={};s[0].split(",").forEach(function(t,e){var a=t.split("=");i[a[0].trim()]=a[1]}),e.push(i)}),e},initWebSocket:function(){this.websock=new WebSocket(i.a.mapSocket+"/"+Object(n.a)()),this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onmessage=this.websocketonmessage,this.websock.onclose=this.websocketclose},websocketonopen:function(){},websocketonerror:function(t){},websocketonmessage:function(t){var e=this.transWebsocketFn(t.data);this.deviceDetailData=e},websocketclose:function(t){}},created:function(){},mounted:function(){this.getDataFn(),this.initWebSocket()},activated:function(){window.scrollTo(0,0)},beforeDestroy:function(){this.websock.close()}}),c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mobile_check_manage_wrap manage_list_wrap custom_flex_column_wrap"},[a("div",{staticClass:"query_data_wrap"},[a("div",{staticClass:"query_data_box"},[a("Field",{attrs:{label:"资产编号",placeholder:"请输入要查询的资产编号"},model:{value:t.queryData.assetID,callback:function(e){t.$set(t.queryData,"assetID",e)},expression:"queryData.assetID"}}),t._v(" "),a("Field",{attrs:{label:"资产名称",placeholder:"请输入要查询的资产名称"},model:{value:t.queryData.assetName,callback:function(e){t.$set(t.queryData,"assetName",e)},expression:"queryData.assetName"}}),t._v(" "),a("div",{staticClass:"tools_button_wrap"},[a("Button",{staticClass:"tools_button",attrs:{icon:"search",type:"primary",round:""},on:{click:t.searchFn}},[t._v("搜索")]),t._v(" "),a("Button",{staticClass:"tools_button",attrs:{icon:"points",type:"info",round:""},on:{click:t.checkFn}},[t._v("盘点")])],1)],1)]),t._v(" "),a("div",{staticClass:"assets_table_wrap"},[a("ul",{staticClass:"assets_table_ul"},[a("li",{staticClass:"assets_table_li assets_table_li_name"},[a("Row",[a("Col",{attrs:{span:"3"}},[a("h4",{staticClass:"assets_table_item assets_table_item_index"},[a("Checkbox",{attrs:{"checked-color":"#07c160"},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}})],1)]),t._v(" "),a("Col",{attrs:{span:"3"}},[a("h4",{staticClass:"assets_table_item"},[t._v("序号")])]),t._v(" "),a("Col",{attrs:{span:"9"}},[a("h4",{staticClass:"assets_table_item"},[t._v("资产名称")])]),t._v(" "),a("Col",{attrs:{span:"9"}},[a("h4",{staticClass:"assets_table_item"},[t._v("盘点日期")])])],1)],1),t._v(" "),a("CheckboxGroup",{ref:"checkboxGroup",model:{value:t.checkedArr,callback:function(e){t.checkedArr=e},expression:"checkedArr"}},t._l(t.assetsDetailData,function(e,s){return a("li",{key:s,staticClass:"assets_table_li",on:{click:function(a){return t.showInfoFn(e)}}},[a("Row",[a("Col",{attrs:{span:"3"}},[a("span",{staticClass:"assets_table_item assets_table_item_index"},[a("Checkbox",{attrs:{name:e.assetID,"checked-color":"#07c160"},on:{click:function(t){t.stopPropagation()}}})],1)]),t._v(" "),a("Col",{attrs:{span:"3"}},[a("span",{staticClass:"assets_table_item assets_table_item_index"},[t._v("\n                        "+t._s(s+1)+"\n                        ")])]),t._v(" "),a("Col",{attrs:{span:"9"}},[a("span",{staticClass:"assets_table_item"},[t._v(t._s(e.assetName?e.assetName:"--"))])]),t._v(" "),a("Col",{attrs:{span:"9"}},[a("span",{staticClass:"assets_table_item"},[t._v(t._s(e.check?e.check:"--"))])])],1)],1)}),0)],1),t._v(" "),a("div",{staticClass:"loading_info_wrap"},[a("Pagination",{directives:[{name:"show",rawName:"v-show",value:t.showPagination&&t.assetsDetailData.length,expression:"showPagination&&assetsDetailData.length"}],attrs:{"total-items":t.totalCount,"show-page-size":2,"prev-text":"上一页","next-text":"下一页","force-ellipses":""},on:{change:t.changePageFn},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}}),t._v(" "),a("Loading",{directives:[{name:"show",rawName:"v-show",value:t.loadingShow,expression:"loadingShow"}],attrs:{size:"24px"}},[t._v("加载中...")])],1)]),t._v(" "),a("Overlay",{attrs:{show:t.showInfo},on:{click:function(e){t.showInfo=!1}}},[a("div",{staticClass:"show_info_wrap"},[a("div",{staticClass:"show_info_box"},[a("Cell",{attrs:{title:"资产id",value:""+(t.editData.assetID?t.editData.assetID:"--")}}),t._v(" "),a("Cell",{attrs:{title:"资产名称",value:""+(t.editData.assetName?t.editData.assetName:"--")}}),t._v(" "),a("Cell",{attrs:{title:"部门名称",value:""+(t.editData.departmentroom?t.editData.departmentroom:"--")}}),t._v(" "),a("Cell",{attrs:{title:"存放地点",value:""+(t.editData.location?t.editData.location:"--")}}),t._v(" "),a("Cell",{attrs:{title:"盘点日期",value:""+(t.editData.check?t.editData.check:"--")}}),t._v(" "),a("Cell",{attrs:{title:"状态"}},["正常"===t.editData.status?a("Tag",{attrs:{size:"medium",type:"success"}},[t._v(t._s(t.editData.status))]):"在修"===t.editData.status?a("Tag",{attrs:{size:"medium",type:"warning"}},[t._v(t._s(t.editData.status))]):"已报废"===t.editData.status?a("Tag",{attrs:{size:"medium",type:"danger"}},[t._v(t._s(t.editData.status))]):a("Tag",{attrs:{size:"medium",type:"default"}},[t._v(t._s(t.editData.status))])],1)],1)])])],1)},staticRenderFns:[]};var l=a("VU/8")(o,c,!1,function(t){a("uEyz")},"data-v-0613f107",null);e.default=l.exports},OeKT:function(t,e,a){a("XqYu")},UEU1:function(t,e,a){a("XqYu"),a("I40i")},d9cu:function(t,e,a){a("XqYu"),a("s1Ps"),a("6d7H")},uEyz:function(t,e){}});