webpackJsonp([18],{"4+RC":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("wdqF"),i=e("8sRp"),n=e("KxKW"),s=e("JtJ0"),r=e("HYs4"),l=e("NHTL"),c=e("yoLw"),p=e("NAz/"),h=e("a84E"),d=e("EMb8"),u=e("7+uW"),m=e("tpLV"),v=e("Gaqz");u.a.component("Icon",d.a),u.a.component("Row",h.a),u.a.component("Col",p.a),u.a.component("Table",c.a),u.a.component("Tag",l.a),u.a.component("Page",r.a),u.a.component("Input",s.a),u.a.component("Button",n.a),u.a.component("Modal",i.a),u.a.component("Spin",o.a);var f={name:"gateway_create",components:{},props:{},data:function(){return{showMap:!1,gatewayData:{mac:"",floor:"11",posi:"",location:""},homeLayers:null,pointLayers:null,deviceMarkers:[],devicePopups:[],map:null,currentFloor:"11",zoomKey:null,uploadModal:!1,achieveUpload:!1,errorUpload:!1}},watch:{currentFloor:function(){this.gatewayData.floor=this.currentFloor}},computed:{},methods:{returnFn:function(){this.$router.go(-1)},initMapFn:function(){this.homeLayers=new L.featureGroup,this.pointLayers=new L.featureGroup,this.markers=[];var t=new L.Proj.CRS("EPSG:4549","+proj=tmerc +lat_0=0 +lon_0=120 +k=1 +x_0=500000 +y_0=0 +ellps=GRS80 +units=m +no_defs",{resolutions:[156367.7919628329,78183.89598141646,39091.94799070823,19545.973995354114,9772.986997677057,4886.4934988385285,2443.2467494192642,1221.6233747096321,610.8116873548161,305.40584367740803,152.70292183870401,76.35146091935201,38.175730459676004,19.087865229838002,9.543932614919001,4.7719663074595005,2.3859831537297502,1.1929915768648751,.5964957884324376,.2982478942162188]}),a=L.latLngBounds(L.latLng(-4.279435,140.075537),L.latLng(-5.438369,138.29733));this.map=L.map("mapID",{center:[-4.9002,139.2102],layers:[this.homeLayers,this.pointLayers],zoom:11,maxZoom:13,minZoom:10,attributionControl:!1,doubleClickZoom:!1,maxBounds:a,crs:t}),this.initBoundaryFn(),this.initHomeLayerFn(m.homeData11),this.initFloorFn(),this.initMarkerFn(),this.initZoomFn()},initMarkerFn:function(){var t=this;this.map.addEventListener("click",function(a){t.removeDeviceMarkerFn(),t.gatewayData.posi="";var o=L.marker(a.latlng,{icon:L.icon({iconUrl:e("xnra"),iconSize:[20]})}).addTo(t.map),i="X:"+a.latlng.lat.toFixed(6)+"</br>Y:"+a.latlng.lng.toFixed(6);console.log("X:"+a.latlng.lat.toFixed(6)+"Y:"+a.latlng.lng.toFixed(6));var n=L.popup({minWidth:120,minHeight:100,closeButton:!1}).setLatLng(a.latlng).setContent(i).openOn(t.map);t.deviceMarkers.push(o),t.devicePopups.push(n),t.gatewayData.posi=[a.latlng.lat.toFixed(6),a.latlng.lng.toFixed(6)]})},initZoomFn:function(){var t=this;this.changeZoomFn(),this.map.addEventListener("zoomend",function(a){t.changeZoomFn()})},changeZoomFn:function(){var t=document.getElementsByClassName("showNAME");if(this.map.getZoom()<11)for(var a=0;a<t.length;a++)t[a].style.display="none";else{for(a=0;a<t.length;a++)t[a].style.display="block";if(13===this.map.getZoom())for(a=0;a<t.length;a++)t[a].style.fontSize="16px";else if(12===this.map.getZoom())for(a=0;a<t.length;a++)t[a].style.fontSize="14px";else for(a=0;a<t.length;a++)t[a].style.fontSize="12px"}},initBoundaryFn:function(){L.Proj.geoJson(m.baseHomeData,{style:function(t){return{color:"#ddd",weight:5,opacity:1,fillOpacity:1}}}).addTo(this.map)},initHomeLayerFn:function(t){var a=this;L.Proj.geoJson(t,{onEachFeature:function(t){t.crs={type:"name",properties:{name:"EPSG:4549"}};var e=a.initColorFn(t.properties.TYPE),o=L.Proj.geoJson(t,{style:function(t){return{color:"#FFFFFF",opacity:1,weight:2,fillColor:e,fillOpacity:1}}}).addTo(a.homeLayers).getBounds(),i=(o._northEast.lat-o._southWest.lat)/2+o._southWest.lat,n=(o._northEast.lng-o._southWest.lng)/2+o._southWest.lng,s='<div class="showNAME">'+t.properties.NAME+"</div>";L.marker([i,n],{icon:L.divIcon({className:"leaflet-echart-icon",html:s}),pro:t.properties}).addTo(a.homeLayers)}})},initColorFn:function(t){switch(t){case"1":var a="#f7f0c5";break;case"2":a="#f7bbdf";break;case"3":a="#aeccfd";break;case"4":a="#88c7f9";break;case"5":a="#c3efc0";break;case"6":a="#c9b8ff";break;default:a="#ddd"}return a},initFloorFn:function(){var t=this;document.getElementById("moniterItem").addEventListener("click",function(a){a.stopPropagation();for(var e=document.getElementById("moniterItem").getElementsByTagName("li"),o=0;o<e.length;o++)e[o].classList.remove("active");switch(a.target.classList.add("active"),a.target.getAttribute("data-value")){case"11":t.clearAllDataFn(),t.initHomeLayerFn(m.homeData11),t.currentFloor="11",t.changeZoomFn();break;case"12":t.clearAllDataFn(),t.initHomeLayerFn(m.homeData12),t.currentFloor="12",t.changeZoomFn();break;case"13":t.clearAllDataFn(),t.initHomeLayerFn(m.homeData13),t.currentFloor="13",t.changeZoomFn()}})},removeDeviceMarkerFn:function(){for(var t=0;t<this.deviceMarkers.length;t++)this.map.removeLayer(this.deviceMarkers[t]);for(var a=0;a<this.devicePopups.length;a++)this.map.removeLayer(this.devicePopups[a]);this.devicePopups=[],this.deviceMarkers=[]},clearAllDataFn:function(){this.homeLayers.clearLayers(),this.removeDeviceMarkerFn(),this.gatewayData.posi=""},initData:function(){this.gatewayData.mac=""},successFn:function(){var t=this;this.achieveUpload=!0,setTimeout(function(){t.uploadModal=!1,t.initData(),setTimeout(function(){t.achieveUpload=!1,t.errorUpload=!1},500)},1e3)},errorFn:function(){var t=this;this.errorUpload=!0,setTimeout(function(){t.uploadModal=!1,setTimeout(function(){t.achieveUpload=!1,t.errorUpload=!1},500)},1e3)},createFn:function(){""===this.gatewayData.mac.trim()||""===this.gatewayData.floor||""===this.gatewayData.posi||""===this.gatewayData.location.trim()?this.$Modal.error({title:"错误",content:"请输入完整信息！"}):(console.log(this.gatewayData),this.uploadModal=!0)}},created:function(){},mounted:function(){var t=this;this.$nextTick(function(){Object(v.b)().then(function(){Object(v.c)().then(function(){Object(v.d)().then(function(){t.showMap=!0,t.$nextTick(function(){t.initMapFn()})})})})})}},g={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"gateway_create_wrap"},[e("div",{staticClass:"row_box hover_animat custom_bg_color_white"},[e("h2",{staticClass:"row_title"},[t._v("地图")]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.showMap,expression:"!showMap"}],staticStyle:{height:"700px","text-align":"center","line-height":"700px"}},[e("h3",[t._v("地图加载中...")])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showMap,expression:"showMap"}],staticStyle:{height:"700px"},attrs:{id:"mapID"}},[t._m(0)])]),t._v(" "),e("div",{staticClass:"row_wrap hover_animat custom_bg_color_white"},[e("div",{staticClass:"row_box"},[t._m(1),t._v(" "),e("div",{staticClass:"form_wrap"},[e("div",{staticClass:"form_item"},[e("Row",{attrs:{gutter:20}},[e("Col",{attrs:{span:"6"}},[e("h3",[t._v("网关mac地址")]),t._v(" "),e("Input",{attrs:{placeholder:"mac地址"},model:{value:t.gatewayData.mac,callback:function(a){t.$set(t.gatewayData,"mac",a)},expression:"gatewayData.mac"}})],1),t._v(" "),e("Col",{attrs:{span:"6"}},[e("h3",[t._v("坐落位置")]),t._v(" "),e("Input",{attrs:{placeholder:"输入房间名等"},model:{value:t.gatewayData.location,callback:function(a){t.$set(t.gatewayData,"location",a)},expression:"gatewayData.location"}})],1),t._v(" "),e("Col",{attrs:{span:"6"}},[e("h3",[t._v("所在楼层")]),t._v(" "),e("Input",{attrs:{disabled:"",placeholder:"所在楼层"},model:{value:t.gatewayData.floor,callback:function(a){t.$set(t.gatewayData,"floor",a)},expression:"gatewayData.floor"}})],1),t._v(" "),e("Col",{attrs:{span:"6"}},[e("h3",[t._v("坐标位置")]),t._v(" "),e("Input",{attrs:{disabled:"",placeholder:"坐标位置"},model:{value:t.gatewayData.posi.toString(),callback:function(a){t.$set(t.gatewayData.posi,"toString()",a)},expression:"gatewayData.posi.toString()"}})],1)],1)],1)]),t._v(" "),e("div",{staticClass:"submit_btn_wrap"},[e("Button",{attrs:{type:"primary",shape:"circle"},on:{click:t.createFn}},[t._v("确定新增")])],1)])]),t._v(" "),e("Modal",{attrs:{title:"","footer-hide":!0,"mask-closable":!1,closable:!1,width:"360"},model:{value:t.uploadModal,callback:function(a){t.uploadModal=a},expression:"uploadModal"}},[e("div",{staticStyle:{"text-align":"center",padding:"20px 0"}},[t.achieveUpload||t.errorUpload?t._e():e("Spin",{attrs:{fix:""}},[e("Icon",{staticClass:"loding_icon",attrs:{type:"ios-loading",size:"18"}}),t._v(" "),e("div",[t._v("正在上传")])],1),t._v(" "),t.achieveUpload?e("Spin",{staticStyle:{color:"#00ad19"},attrs:{fix:""}},[e("Icon",{attrs:{type:"ios-checkmark-circle",size:"18"}}),t._v(" "),e("div",[t._v("上传成功")])],1):t._e(),t._v(" "),t.errorUpload?e("Spin",{staticStyle:{color:"#f72b2b"},attrs:{fix:""}},[e("Icon",{attrs:{type:"ios-close-circle",size:"18"}}),t._v(" "),e("div",[t._v("上传失败")])],1):t._e()],1)])],1)},staticRenderFns:[function(){var t=this.$createElement,a=this._self._c||t;return a("div",{attrs:{id:"moniter"}},[a("ul",[a("li",{staticStyle:{background:"#fff",color:"#558eea"}},[this._v("楼层选择")])]),this._v(" "),a("ul",{attrs:{id:"moniterItem"}},[a("li",{staticClass:"active",attrs:{"data-value":"11"}},[this._v("十一层")]),this._v(" "),a("li",{attrs:{"data-value":"12"}},[this._v("十二层")]),this._v(" "),a("li",{attrs:{"data-value":"13"}},[this._v("十三层")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{staticClass:"row_title"},[this._v("网关信息"),a("span",{staticStyle:{"font-size":"14px"}},[this._v("（在地图上选择点位后会自动填充位置信息到下方输入框中）")])])}]};var _=e("VU/8")(f,g,!1,function(t){e("fJCv")},"data-v-cade7100",null);a.default=_.exports},fJCv:function(t,a){}});