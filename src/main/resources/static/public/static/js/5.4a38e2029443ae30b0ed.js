webpackJsonp([5],{"6d7H":function(e,t){},"IWx/":function(e,t){},OeKT:function(e,t,a){a("XqYu"),a("ozXw")},PmD9:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("mvHQ"),i=a.n(s),o=a("bOdI"),n=a.n(o),r=a("Fd2+"),l=(a("jgNZ"),a("dKGA"),a("FDxC"),a("2PSJ"),a("uTM9"),a("9ULi"),a("jydU"),a("wvM5"),a("tLo2"),a("Rv11"),a("UEU1"),a("d9cu"),a("OeKT"),a("Nf3R"),a("MHRi"),a("GKy3"),a("4T1P"),a("wDsp")),c=a("TIfe"),m=a("/WQG"),_={name:"mobile_temp_manage",components:{Button:r.b,Row:r.w,Col:r.g,Tag:r.z,Loading:r.o,Search:r.x,Icon:r.m,Field:r.l,Popup:r.u,Picker:r.s,Pagination:r.r,CheckboxGroup:r.f,Checkbox:r.e,Popover:r.t,Dialog:r.k,Toast:r.A,Notify:r.q},props:{},data:function(){var e;return e={role:this.$store.state.role,warningDialogShow:!1,typeDialogShow:!1,departmentDialogShow:!1,tempDetailData:[],tempDetailDataNow:[],tempDetailDataAll:[],tempWarningArr:[],queryData:{freezernumber:"",mac:"",freezername:"",department:"",type:""},queryDataNow:{freezernumber:"",mac:"",freezername:"",department:"",type:""},instrumentType:m.a,departmentroomArr:[],value:"",showSearchPane:!1,loadingShow:!0,websock:null,warningSocket:null,showPagination:!1,currentPage:1,totalCount:0,pageSize:10,searchMode:!1,changePageMode:!1,selectMode:!1,checkedArr:[],checkAll:!1},n()(e,"selectMode",!1),n()(e,"showPopover",!1),n()(e,"actions",[{text:"仪器新增",icon:"plus"},{text:"选择",icon:"certificate"}]),e},watch:{mobileScroll:function(){if(!this.selectMode){var e=this.mobileScroll;e>54?this.$refs.mobileSearchBoxFixed.classList.add("show"):0===e&&this.$refs.mobileSearchBoxFixed.classList.remove("show")}},checkedArr:function(){this.checkedArr.length&&this.checkedArr.length===this.tempDetailDataNow.length?this.checkAll=!0:this.checkAll=!1}},computed:{mobileScroll:function(){return this.$store.state.mobileScroll}},methods:{onSelect:function(e){switch(e.text){case"仪器新增":this.toCreateFn();break;case"选择":this.enterSelectFn()}},enterSelectFn:function(){this.selectMode=!0,this.$refs.assetsTableWrap.style.paddingBottom="60px"},exitSelectFn:function(){this.showPopover=!1,this.selectMode=!1,this.checkedArr=[],this.$refs.assetsTableWrap.style.paddingBottom="0"},checkAllFn:function(){!1===this.checkAll?this.$refs.checkboxGroup.toggleAll():this.$refs.checkboxGroup.toggleAll(!0)},deleteFn:function(){var e=this,t=[];this.checkedArr.forEach(function(a,s){e.tempDetailDataNow.forEach(function(e,s){a===e.freezernumber&&t.push(e.mac)})}),t.length?r.k.confirm({title:"提示！",message:'<span style="color:#ee0a24;">你确定要删除这'+t.length+"个仪器吗？</span>",confirmButtonColor:"#ee0a24"}).then(function(){e.deleteCertainFn(t)}).catch(function(){}):this.$notify({type:"warning",message:"请至少选择一个仪器！",duration:2e3})},deleteCertainFn:function(e){var t=this,a=r.A.loading({message:"正在删除...",forbidClick:!0,duration:0});this.$axios.get(l.a.tempDelete+e).then(function(e){0===e.data.code?(a.clear(),r.A.success("删除成功！"),t.exitSelectFn(),t.checkedArr=[]):(a.clear(),r.A.fail("删除失败！"))}).catch(function(e){a.clear(),r.A.fail("删除失败！")})},getTypeFn:function(e){this.queryData.type=e.key,this.typeDialogShow=!1},getDepartmentFn:function(e){this.queryData.department=e.key,this.departmentDialogShow=!1},showMoreMenuFn:function(){this.$emit("getMessage",!0)},openSearchPaneFn:function(){this.showSearchPane=!0},toTempDetailFn:function(e){this.$router.push({path:"/mobile/temp_detail/"+e})},toTempEditFn:function(e){this.$router.push({path:"/mobile/temp_edit/"+e})},toCreateFn:function(){this.$router.push({path:"/mobile/temp_create"})},searchTempFn:function(){var e=this;this.tempDetailDataNow=[],this.searchMode=!0,this.checkedArr=[],this.selectMode=!1,this.loadingShow=!0,this.showSearchPane=!1,setTimeout(function(){e.queryDataNow=JSON.parse(i()(e.queryData)),e.currentPage=1,e.filterSearchFn(e.tempDetailDataAll)},300)},filterSearchFn:function(e){var t=this,a=0,s=0;for(var o in this.queryDataNow)""===this.queryDataNow[o].trim()&&s++,a++;if(s<a){var n=[];e.forEach(function(e,a){var s=0,i=0;for(var o in t.queryDataNow)if(void 0===e[o]&&(e[o]=""),""!==t.queryDataNow[o].trim())if(s++,"freezernumber"===o||"mac"===o)e[o].trim().toLowerCase()===t.queryDataNow[o].trim().toLowerCase()&&i++;else if("freezername"===o){var r=new RegExp(t.queryDataNow[o].trim());e[o].trim().match(r)&&i++}else if("department"===o){r=new RegExp(t.queryDataNow[o].trim());e[o].trim().match(r)&&i++}else e[o].trim()===t.queryDataNow[o].trim()&&i++;s===i&&n.push(e)}),this.setPageFn(n),this.tempDetailData=JSON.parse(i()(n))}else this.setPageFn(e),this.tempDetailData=JSON.parse(i()(e))},clearTempFn:function(){for(var e in this.queryData)this.queryData[e]=""},initWebSocket:function(){this.websock=new WebSocket(l.a.tempDetailSocket+"/"+Object(c.a)()),this.websock.onmessage=this.websocketonmessage},websocketonmessage:function(e){if(e.data){var t=JSON.parse(e.data),a=this.formatTempFn(t);this.tempDetailDataAll=JSON.parse(i()(a)),this.selectMode||this.changePageMode||(this.searchMode?this.filterSearchFn(a):(this.setPageFn(a),this.tempDetailData=JSON.parse(i()(a))),this.loadingShow=!1)}},initWarningSocket:function(){this.warningSocket=new WebSocket(l.a.tempWarningSocket+"/"+Object(c.a)()),this.warningSocket.onmessage=this.warningSocketOnMessage},warningSocketOnMessage:function(e){if(e.data){var t=JSON.parse(e.data);this.tempDetailDataAll.forEach(function(e,a){for(var s=0;s<t.length;s++)t[s].equipID===e.mac&&(t[s].locDept=e.department,t[s].freezername=e.freezername,t[s].location=e.location)}),this.tempWarningArr=t}},setPageFn:function(e){if(e.length){for(var t=[],a=this.pageSize*(this.currentPage-1),s=this.pageSize*this.currentPage-1>e.length-1?e.length-1:this.pageSize*this.currentPage-1,i=a;i<=s;i++)t.push(e[i]);this.tempDetailDataNow=t,this.totalCount=e.length}else this.tempDetailDataNow=[],this.currentPage=1,this.totalCount=0;this.loadingShow&&(this.loadingShow=!1)},changePageFn:function(e){var t=this;this.changePageMode=!0,this.checkedArr=[],this.tempDetailDataNow=[],this.loadingShow=!0,setTimeout(function(){var a=[];if(t.tempDetailData.length){for(var s=t.pageSize*(e-1),i=t.pageSize*e-1>t.tempDetailData.length-1?t.tempDetailData.length-1:t.pageSize*e-1,o=s;o<=i;o++)a.push(t.tempDetailData[o]);t.tempDetailDataNow=a}t.currentPage=e,t.loadingShow=!1,t.changePageMode=!1},300)},formatTempFn:function(e){var t=[];return e.forEach(function(e,a){var s={freezername:e.freezername?e.freezername:"--",freezernumber:e.freezernumber?e.freezernumber:"--",location:e.location?e.location:"--",department:e.department?e.department:"--",type:e.type?e.type:"--",mac:e.mac?e.mac:"--",temp:e.temperature?Number(Number(e.temperature).toFixed(2)):"",humi:e.humidity?Number(Number(e.humidity).toFixed(2)):"",topTemp:e.toptemperature?Number(Number(e.toptemperature).toFixed(2)):"",topHum:e.tophumidity?Number(Number(e.tophumidity).toFixed(2)):"",bottomTemp:e.mintemperature?Number(Number(e.mintemperature).toFixed(2)):"",bottomHum:e.minhumidity?Number(Number(e.minhumidity).toFixed(2)):"",electric:e.electric?e.electric:"",currenttime:e.currenttime?e.currenttime:""};t.push(s)}),t}},created:function(){var e=[];this.$store.state.departmentroom.split(",").forEach(function(t,a){e.push({key:t,text:t})}),this.departmentroomArr=e},mounted:function(){},activated:function(){this.exitSelectFn(),this.initWebSocket(),this.initWarningSocket()},deactivated:function(){this.exitSelectFn(),this.websock.close(),this.warningSocket.close()},beforeDestroy:function(){}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mobile_temp_manage_wrap manage_list_wrap custom_flex_column_wrap"},[a("div",{staticClass:"mobile_search_wrap"},[e.selectMode?e._e():a("div",{ref:"mobileSearchBoxFixed",staticClass:"mobile_search_box"},[a("div",{staticClass:"mobile_search_box_left"},[a("Search",{attrs:{disabled:"",placeholder:"点击展开搜索面板",shape:"round"},on:{click:e.openSearchPaneFn},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1),e._v(" "),a("div",{staticClass:"mobile_search_box_right"},[a("div",{staticClass:"mobile_search_box_right_tools temp_notice_icon",staticStyle:{width:"60px"}},[a("Icon",{attrs:{name:"volume-o"},on:{click:function(t){e.warningDialogShow=!0}}}),e._v(" "),this.tempWarningArr.length?a("span",{staticClass:"right_dot_notice error"},[e._v(e._s(this.tempWarningArr.length>99?"99+":this.tempWarningArr.length))]):e._e()],1),e._v(" "),a("div",{staticClass:"mobile_search_box_right_tools",staticStyle:{width:"40px"}},[a("Popover",{attrs:{trigger:"click",actions:e.actions,placement:"bottom-end",theme:"dark"},on:{select:e.onSelect},scopedSlots:e._u([{key:"reference",fn:function(){return[a("Icon",{attrs:{name:"add-o"}})]},proxy:!0}],null,!1,2721235328),model:{value:e.showPopover,callback:function(t){e.showPopover=t},expression:"showPopover"}})],1),e._v(" "),a("div",{staticClass:"mobile_search_box_right_tools",staticStyle:{width:"40px"}},[a("Icon",{attrs:{name:"bars"},on:{click:e.showMoreMenuFn}})],1)])])]),e._v(" "),a("div",{ref:"assetsTableWrap",staticClass:"assets_table_wrap"},[a("div",{staticClass:"assets_table_wrap_content  clearfix"},[a("div",{staticClass:"assets_table_wrap_left"},[a("ul",{staticClass:"assets_table_ul"},[a("li",{staticClass:"assets_table_li assets_table_li_name"},[e.selectMode?a("div",{staticClass:"assets_table_li_checkbox"},[a("Checkbox",{attrs:{"checked-color":"#07c160"},on:{click:e.checkAllFn},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}})],1):a("div",{staticClass:"assets_table_item"},[a("p",[e._v("序号")])])]),e._v(" "),e.selectMode?a("CheckboxGroup",{ref:"checkboxGroup",model:{value:e.checkedArr,callback:function(t){e.checkedArr=t},expression:"checkedArr"}},e._l(e.tempDetailDataNow,function(e,t){return a("li",{key:t,staticClass:"assets_table_li"},[a("div",{staticClass:"assets_table_li_checkbox"},[a("Checkbox",{attrs:{name:e.freezernumber,"checked-color":"#07c160"},on:{click:function(e){e.stopPropagation()}}})],1)])}),0):e._l(e.tempDetailDataNow,function(t,s){return a("li",{key:s,staticClass:"assets_table_li"},[a("div",{staticClass:"assets_table_item"},[a("p",[e._v(e._s(s+1))])])])})],2)]),e._v(" "),a("div",{staticClass:"assets_table_wrap_right"},[a("ul",{staticClass:"assets_table_ul"},[e._m(0),e._v(" "),e._l(e.tempDetailDataNow,function(t,s){return a("li",{key:s,staticClass:"assets_table_li clearfix"},[a("div",{staticClass:"assets_table_item"},[a("p",[e._v("\n                                 "+e._s(t.freezernumber?t.freezernumber:"--")+"\n                             ")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("\n                                  "+e._s(t.freezername?t.freezername:"--")+" \n                             ")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("\n                                  "+e._s(t.temp?t.temp+"℃":"--")+"\n                             ")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("\n                                  "+e._s(t.humi?t.humi+"%":"--")+"\n                             ")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("\n                                  "+e._s(t.topTemp?t.topTemp+"℃":"--")+"\n                              ")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("\n                                  "+e._s(t.bottomTemp?t.bottomTemp+"℃":"--")+"\n                              ")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("\n                                  "+e._s(t.topHum?t.topHum+"%":"--")+"\n                              ")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("\n                                  "+e._s(t.bottomHum?t.bottomHum+"%":"--")+"\n                              ")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("\n                                  "+e._s(t.electric?t.electric+"%":"--")+"\n                              ")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("\n                                  "+e._s(t.mac?t.mac:"--")+"\n                             ")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("\n                                  "+e._s(t.type?t.type:"--")+"\n                             ")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("\n                                  "+e._s(t.department?t.department:"--")+"\n                             ")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("\n                                  "+e._s(t.location?t.location:"--")+"\n                             ")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("\n                                  "+e._s(t.currenttime?t.currenttime:"--")+"\n                             ")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("Button",{attrs:{round:"",size:"small"},on:{click:function(a){return e.toTempDetailFn(t.mac)}}},[e._v("查看")]),e._v(" "),a("Button",{attrs:{round:"",size:"small"},on:{click:function(a){return e.toTempEditFn(t.mac)}}},[e._v("编辑")])],1)])})],2)])]),e._v(" "),a("div",{staticClass:"loading_info_wrap"},[a("Pagination",{directives:[{name:"show",rawName:"v-show",value:!e.loadingShow&&e.tempDetailDataNow.length,expression:"!loadingShow&&tempDetailDataNow.length"}],attrs:{"total-items":e.totalCount,"show-page-size":2,"items-per-page":e.pageSize,"prev-text":"上一页","next-text":"下一页","force-ellipses":"",mode:"simple"},on:{change:e.changePageFn},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}}),e._v(" "),a("Loading",{directives:[{name:"show",rawName:"v-show",value:e.loadingShow,expression:"loadingShow"}],attrs:{size:"24px"}},[e._v("加载中...")]),e._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:!e.loadingShow&&!e.tempDetailDataNow.length,expression:"!loadingShow&&!tempDetailDataNow.length"}]},[e._v("暂无数据")])],1)]),e._v(" "),a("Popup",{attrs:{position:"top",round:""},model:{value:e.showSearchPane,callback:function(t){e.showSearchPane=t},expression:"showSearchPane"}},[a("div",{staticClass:"query_data_wrap"},[a("div",{staticClass:"query_data_box"},[a("Field",{attrs:{clearable:"",label:"仪器编号",placeholder:"请输入仪器编号"},model:{value:e.queryData.freezernumber,callback:function(t){e.$set(e.queryData,"freezernumber",t)},expression:"queryData.freezernumber"}}),e._v(" "),a("Field",{attrs:{clearable:"",label:"仪器名称",placeholder:"请输入仪器名称"},model:{value:e.queryData.freezername,callback:function(t){e.$set(e.queryData,"freezername",t)},expression:"queryData.freezername"}}),e._v(" "),a("Field",{attrs:{clearable:"",label:"mac地址",placeholder:"请输入mac地址"},model:{value:e.queryData.mac,callback:function(t){e.$set(e.queryData,"mac",t)},expression:"queryData.mac"}}),e._v(" "),a("Field",{attrs:{clearable:"",readonly:"",label:"部门名称",placeholder:"请选择部门"},on:{click:function(t){e.departmentDialogShow=!0}},model:{value:e.queryData.department,callback:function(t){e.$set(e.queryData,"department",t)},expression:"queryData.department"}}),e._v(" "),a("Field",{attrs:{clearable:"",readonly:"",label:"仪器类型",placeholder:"请选择仪器类型"},on:{click:function(t){e.typeDialogShow=!0}},model:{value:e.queryData.type,callback:function(t){e.$set(e.queryData,"type",t)},expression:"queryData.type"}})],1),e._v(" "),a("div",{staticClass:"tools_button_wrap"},[a("Button",{staticClass:"tools_button",attrs:{color:"linear-gradient(to right, #ff6034, #ee0a24)",round:""},on:{click:e.clearTempFn}},[e._v("清空")]),e._v(" "),a("Button",{staticClass:"tools_button",attrs:{color:"linear-gradient(to right, #69aff5, #1989fa)",round:""},on:{click:e.searchTempFn}},[e._v("搜索")])],1)])]),e._v(" "),a("Popup",{attrs:{position:"bottom"},model:{value:e.typeDialogShow,callback:function(t){e.typeDialogShow=t},expression:"typeDialogShow"}},[a("Picker",{attrs:{columns:e.instrumentType,"show-toolbar":"",title:"请选择类型","visible-item-count":5},on:{cancel:function(t){e.typeDialogShow=!1},confirm:e.getTypeFn}})],1),e._v(" "),a("Popup",{attrs:{position:"bottom"},model:{value:e.departmentDialogShow,callback:function(t){e.departmentDialogShow=t},expression:"departmentDialogShow"}},[a("Picker",{attrs:{columns:e.departmentroomArr,"show-toolbar":"",title:"请选择部门","visible-item-count":5},on:{cancel:function(t){e.departmentDialogShow=!1},confirm:e.getDepartmentFn}})],1),e._v(" "),a("Popup",{staticClass:"warning_wrap",style:{width:"70%",height:"100%"},attrs:{position:"right"},model:{value:e.warningDialogShow,callback:function(t){e.warningDialogShow=t},expression:"warningDialogShow"}},[a("div",{staticClass:"temp_warning_title"},[a("h2",[e._v("温湿度异常一览")])]),e._v(" "),e.tempWarningArr.length?a("ul",e._l(e.tempWarningArr,function(t,s){return a("li",{staticClass:"warning_li"},[a("p",[a("b",[e._v(e._s(s+1)+" - "+e._s(t.freezername)+" - "+e._s(t.name))])]),e._v(" "),a("p",[e._v("告警内容："),a("b",{staticClass:"warning_imp"},[e._v(e._s(t.desc))])]),e._v(" "),t.electric?a("p",[e._v("电量："),a("b",{staticClass:"warning_imp"},[e._v(e._s(t.electric))])]):e._e(),e._v(" "),t.temperature?a("p",[e._v("温度："),a("b",{staticClass:"warning_imp"},[e._v(e._s(t.temperature))])]):e._e(),e._v(" "),t.temperaturefitted?a("p",[e._v("温度范围："),a("b",[e._v(e._s(t.temperaturefitted))])]):e._e(),e._v(" "),t.humidity?a("p",[e._v("湿度："),a("b",{staticClass:"warning_imp"},[e._v(e._s(t.humidity))])]):e._e(),e._v(" "),t.humidityfitted?a("p",[e._v("湿度范围："),a("b",[e._v(e._s(t.humidityfitted))])]):e._e(),e._v(" "),t.equipID?a("p",[e._v("mac："),a("b",[e._v(e._s(t.equipID))])]):e._e(),e._v(" "),t.location?a("p",[e._v("位置："),a("b",[e._v(e._s(t.location))])]):e._e(),e._v(" "),t.locDept?a("p",[e._v("所在科室："),a("b",[e._v(e._s(t.locDept))])]):e._e(),e._v(" "),t.date?a("p",[e._v("日期："),a("b",[e._v(e._s(t.date))])]):e._e()])}),0):a("p",{staticClass:"warning_notice"},[e._v("暂无异常告警!")])]),e._v(" "),a("div",{class:e.selectMode?"header_tools_wrap show":"header_tools_wrap"},[a("Button",{attrs:{round:"",size:"small",type:"info"},on:{click:e.exitSelectFn}},[e._v("完成")])],1),e._v(" "),a("div",{class:e.selectMode?"footer_tools_wrap show":"footer_tools_wrap"},[a("Button",{attrs:{disabled:"admin"!==e.role,round:"",size:"small",type:"danger"},on:{click:e.deleteFn}},[e._v("删除")])],1)],1)},staticRenderFns:[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("li",{staticClass:"assets_table_li assets_table_li_name clearfix"},[a("div",{staticClass:"assets_table_item"},[a("p",[e._v("编号")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("名称")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("温度（℃）")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("湿度（%）")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("今日最高温度（℃）")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("今日最低温度（℃）")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("今日最高湿度（%）")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("今日最低湿度（%）")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("电量（%）")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("mac")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("类型")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("部门名称")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("位置")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("数据接收时间")])]),e._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[e._v("操作")])])])}]};var h=a("VU/8")(_,p,!1,function(e){a("IWx/")},"data-v-9e4edb7a",null);t.default=h.exports},d9cu:function(e,t,a){a("XqYu"),a("j7dL"),a("9fCr"),a("6d7H")},ozXw:function(e,t){}});