webpackJsonp([18],{LjVW:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=s("KxKW"),i=s("JtJ0"),a=s("7+uW"),o=s("TIfe"),n=s("wDsp");a.a.component("Input",i.a),a.a.component("Button",r.a);var c={name:"login",components:{},props:{},data:function(){return{account:"",password:"",verification:"",loginDisable:!1,loginBg:s("npKG")}},watch:{},computed:{loginImg:function(){return"background-image:url('"+this.loginBg+"')"}},methods:{inputBlurFn:function(t){var e={accountMsg:"账号不能为空",passwordMsg:"密码不能为空",verificationMsg:"验证码不正确"};"verification"===t?this[t].trim().toUpperCase()!==this.$refs.verfication_view_code.innerText.toUpperCase()?(this.$refs[t+"Error"].classList.add("show"),this.$refs[t+"Error"].innerText=e[t+"Msg"]):(this.$refs[t+"Error"].classList.remove("show"),this.$refs[t+"Error"].innerText=""):""===this[t].trim()?(this.$refs[t+"Error"].classList.add("show"),this.$refs[t+"Error"].innerText=e[t+"Msg"]):(this.$refs[t+"Error"].classList.remove("show"),this.$refs[t+"Error"].innerText="")},updateCodeFn:function(){for(var t="0123456789abcdefghijklmnopqrstuvwxyz",e="",s=0;s<4;s++)e+=t[parseInt(Math.random()*t.length)];this.$refs.verfication_view_code.innerText=e},handleLoginFn:function(){var t=this;if(this.inputBlurFn("account"),this.inputBlurFn("password"),this.inputBlurFn("verification"),this.account.trim()&&this.password.trim()&&this.verification.trim()&&this.verification.trim()&&this.verification.trim().toUpperCase()===this.$refs.verfication_view_code.innerText.toUpperCase()){this.loginDisable=!0;var e={username:this.account.trim(),password:this.password.trim()};this.$axios.post(n.a.login,e).then(function(e){if(e.data.token){var s=e.data.token,r=e.data.user,i="",a="";if(!r.authority)return t.$Message.error({content:"该账号没有权限！",duration:2}),t.updateCodeFn(),void(t.loginDisable=!1);Object(o.c)(s),t.$store.commit("setUser",r.username),t.$store.commit("setRole",r.role),t.$store.commit("setDepartmentroom",r.departmentroom?r.departmentroom:""),t.$store.commit("setAddress",r.address),t.$store.commit("setAuthority",JSON.parse(r.authority)),t.$store.commit("setRoutes",r.role);var n={},c={};for(var l in r)"memory"===l.substring(0,6)?n[l]=r[l]:"isShow"===l.substring(0,6)&&(c[l]=r[l]);switch(t.$store.commit("setQueryData",n),t.$store.commit("setChooseData",c),r.address){case"1":i="华西医院",a=t.$store.state.routes[1].children[0].path;break;default:return}t.$store.commit("setProject",i),t.$router.addRoutes(t.$store.state.routes),t.$Message.success({content:"登录成功!",duration:.5}),setTimeout(function(){t.$router.push({path:a})},500)}else e.data.message&&(t.$Message.error({content:e.data.message,duration:2}),t.updateCodeFn(),t.loginDisable=!1)}).catch(function(e){t.$Message.error({content:"登录错误！",duration:2}),t.updateCodeFn(),t.loginDisable=!1})}else this.$Message.error({content:"请正确填写完必要信息！",duration:2})}},created:function(){},mounted:function(){this.updateCodeFn()}},l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"login_wrap"},[t._m(0),t._v(" "),s("div",{staticClass:"content"},[s("div",{staticClass:"content_box"},[s("div",{staticClass:"img_box",style:t.loginImg}),t._v(" "),s("div",{staticClass:"login_box"},[t._m(1),t._v(" "),s("div",{staticClass:"col_wrap account_wrap"},[s("Input",{staticClass:"account_input",attrs:{size:"large",placeholder:"请输入帐户名",clearable:""},on:{"on-blur":function(e){return t.inputBlurFn("account")}},model:{value:t.account,callback:function(e){t.account=e},expression:"account"}}),t._v(" "),s("span",{ref:"accountError",staticClass:"error_msg"})],1),t._v(" "),s("div",{staticClass:"col_wrap password_wrap"},[s("Input",{staticClass:"password_input",attrs:{type:"password",size:"large",placeholder:"请输入密码",clearable:""},on:{"on-blur":function(e){return t.inputBlurFn("password")}},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),t._v(" "),s("span",{ref:"passwordError",staticClass:"error_msg"})],1),t._v(" "),s("div",{staticClass:"col_wrap verification_wrap"},[s("div",{staticClass:"verification_wrap_top"},[s("div",{staticClass:"left_box"},[s("Input",{staticClass:"verfication_code_input",attrs:{size:"large",placeholder:"验证码",clearable:""},on:{"on-enter":t.handleLoginFn,"on-blur":function(e){return t.inputBlurFn("verification")}},model:{value:t.verification,callback:function(e){t.verification=e},expression:"verification"}})],1),t._v(" "),s("div",{staticClass:"right_box"},[s("h3",{ref:"verfication_view_code",attrs:{onselectstart:"return false"},on:{click:t.updateCodeFn}})])]),t._v(" "),s("span",{ref:"verificationError",staticClass:"error_msg"})]),t._v(" "),s("div",{staticClass:"col_wrap"},[s("Button",{attrs:{shape:"circle",disabled:t.loginDisable,type:"primary",id:"login_btn"},on:{click:t.handleLoginFn}},[t._v("登录")])],1)])])]),t._v(" "),s("div",{staticClass:"footer"})])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"header"},[e("div",{staticClass:"header_box"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"col_wrap title_wrap"},[e("h1",[this._v("医疗资产追踪管理系统")])])}]};var u=s("VU/8")(c,l,!1,function(t){s("yCqc")},"data-v-440083b8",null);e.default=u.exports},npKG:function(t,e,s){t.exports=s.p+"public/static/img/login_bg.8197232.jpg"},yCqc:function(t,e){}});