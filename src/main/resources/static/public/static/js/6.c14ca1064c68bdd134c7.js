webpackJsonp([6],{"6d7H":function(t,e){},Medb:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("mvHQ"),o=a.n(s),i=a("bOdI"),c=a.n(i),n=a("Fd2+"),l=(a("FDxC"),a("2PSJ"),a("d9cu"),a("OeKT"),a("MHRi"),a("GKy3"),a("uTM9"),a("UEU1"),a("wvM5"),a("tLo2"),a("9ULi"),a("jydU"),a("4T1P"),a("Rv11"),a("Nf3R"),a("wDsp")),r=a("TIfe"),u=(a("q29v"),a("ao6w")),h=a("eJLk"),p={name:"mobile_check_manage",components:{Button:n.b,Tag:n.z,CheckboxGroup:n.f,Checkbox:n.e,Dialog:n.k,Toast:n.A,Loading:n.o,Pagination:n.r,Field:n.l,Popup:n.u,Search:n.x,Icon:n.m,Notify:n.q,Picker:n.s,Popover:n.t},props:{},data:function(){var t;return t={inputData:[],inputDataAll:[],inputSearchValue:"",activeKey:"",showInputSearch:!1,statusColor:h.a,user:this.$store.state.user,currentPage:1,totalCount:0,hasMore:!0,checked:!0,assetsDetailData:[],deviceDetailData:[],checkedArr:[],checkAll:!1,loadingShow:!0,showPagination:!1,queryData:{assetID:"",assetName:"",memorydepart:"",memorylocDept:"",mac:"",status:""},queryDataNow:{},websock:null,value:"",showSearchPane:!1},c()(t,"showSearchPane",!1),c()(t,"statusDialogShow",!1),c()(t,"statusData",u.a),c()(t,"selectMode",!1),c()(t,"showPopover",!1),c()(t,"actions",[{text:"盘点历史",icon:"todo-list-o"},{text:"选择",icon:"certificate"}]),t},watch:{deviceDetailData:function(){var t=this;this.deviceDetailData.forEach(function(e,a){t.assetsDetailData.forEach(function(t,a){e.Mac===t.mac&&(t.location=e.Location)})})},checkedArr:function(){this.checkedArr.length&&this.checkedArr.length===this.assetsDetailData.length?this.checkAll=!0:this.checkAll=!1},mobileScroll:function(){if(!this.selectMode){var t=this.mobileScroll;t>54?this.$refs.mobileSearchBoxFixed.classList.add("show"):0===t&&this.$refs.mobileSearchBoxFixed.classList.remove("show")}}},computed:{assetsDetailDataNow:function(){return this.assetsDetailData},mobileScroll:function(){return this.$store.state.mobileScroll}},methods:{onSelect:function(t){switch(t.text){case"盘点历史":this.toCheckHistoryFn();break;case"选择":this.enterSelectFn()}},enterSelectFn:function(){this.selectMode=!0,this.$refs.assetsTableWrap.style.paddingBottom="60px"},exitSelectFn:function(){this.showPopover=!1,this.selectMode=!1,this.checkedArr=[],this.$refs.assetsTableWrap.style.paddingBottom="0"},toCheckFn:function(){var t=this,e=[];this.checkedArr.forEach(function(a,s){t.assetsDetailData.forEach(function(t,s){a===t.assetID&&e.push(t)})}),e.length?n.k.confirm({title:"提示！",message:'<span style="color:#ee0a24;">你确定要盘点这'+e.length+"个资产吗？</span>",confirmButtonColor:"#ee0a24"}).then(function(){t.checkCertainFn(e)}).catch(function(){}):this.$notify({type:"warning",message:"请至少选择一个资产！",duration:2e3})},certainSelectFn:function(t){"departmentroom"===this.activeKey?this.queryData.memorydepart=t:"locDept"===this.activeKey?this.queryData.memorylocDept=t:this.queryData[this.activeKey]=t,this.showInputSearch=!1,this.inputSearchValue="",this.activeKey=""},showInputSearchFn:function(t){this.showInputSearch=!0,this.activeKey=t,this.inputFocusFn(t)},handleSearchFn:function(t){this.inputData=this.inputDataAll.filter(function(e){return e.toLowerCase().indexOf(t.toLowerCase())>-1})},inputFocusFn:function(t){var e=this;this.inputDataAll=[],this.inputData=[];var a=[],s={};s[t]="1",a.push(s),this.$axios.post(l.a.inputQuery,a).then(function(a){a.data.data.forEach(function(a,s){e.inputDataAll.find(function(e){return e===a[t]})||e.inputDataAll.push(a[t])}),e.inputData=JSON.parse(o()(e.inputDataAll))}).catch(function(t){console.log(t)})},getStatusFn:function(t){this.queryData.status=t.text,this.statusDialogShow=!1},clearAssetsFn:function(){for(var t in this.queryData)this.queryData[t]=""},showMoreMenuFn:function(){this.$emit("getMessage",!0)},toCheckHistoryFn:function(){this.$router.push("/mobile/check_history")},openSearchPaneFn:function(){this.showSearchPane=!0},searchFn:function(){this.queryDataNow=JSON.parse(o()(this.queryData)),this.currentPage=1,this.assetsDetailData=[],this.checkedArr=[],this.checkAll=!1,this.totalCount=0,this.getDataFn(),this.showSearchPane=!1},checkAllFn:function(){!1===this.checkAll?this.$refs.checkboxGroup.toggleAll():this.$refs.checkboxGroup.toggleAll(!0)},checkCertainFn:function(t){var e=this,a=[];t.forEach(function(t,e){var s={assetID:t.assetID.trim()};a.push(s)});var s=this.$toast.loading({message:"正在盘点...",forbidClick:!0,duration:0});this.$axios.post(l.a.assetsCheck+"checkpep="+this.user,a).then(function(t){0===t.data.code?(s.clear(),e.$toast.success("盘点成功！"),e.exitSelectFn(),e.assetsDetailData=[],e.totalCount=0,e.getDataFn()):(s.clear(),e.$toast.fail("盘点失败！"))}).catch(function(t){s.clear()})},getDataFn:function(){var t=this;this.loadingShow=!0,this.assetsDetailData=[];var e="";for(var a in this.queryDataNow)this.queryDataNow[a]||(this.queryDataNow[a]=""),e+=a+"="+this.queryDataNow[a].trim()+"&";e=e.substring(0,e.length-1),this.$axios.post(l.a.assetsQuery+"?currentPage=&"+e).then(function(e){for(var a=e.data,s=Number(a.pop().total),o=0;o<a.length;o++){for(var i in a[o])""!==a[o][i]&&"null"!==a[o][i]||(a[o][i]="--");t.assetsDetailData.push(a[o])}t.totalCount=s,t.loadingShow=!1,t.showPagination=!0}).catch(function(t){})},changePageFn:function(){this.checkedArr=[],this.checkAll=!1,this.getDataFn()},transWebsocketFn:function(t){var e=[],a=t.split("{");return a.splice(0,1),a.forEach(function(t,a){var s=t.split("}");s.splice(s.length-1,1);var o={};s[0].split(",").forEach(function(t,e){var a=t.split("=");o[a[0].trim()]=a[1]}),e.push(o)}),e},initWebSocket:function(){this.websock=new WebSocket(l.a.mapSocket+"/"+Object(r.a)()),this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onmessage=this.websocketonmessage,this.websock.onclose=this.websocketclose},websocketonmessage:function(t){var e=this.transWebsocketFn(t.data);this.deviceDetailData=e},getSearchConfigFn:function(){this.queryDataNow=JSON.parse(o()(this.queryData)),this.getDataFn()}},created:function(){},mounted:function(){this.getSearchConfigFn()},activated:function(){this.initWebSocket(),this.exitSelectFn()},deactivated:function(){this.exitSelectFn(),this.websock.close()}},_={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mobile_check_manage_wrap manage_list_wrap custom_flex_column_wrap"},[a("div",{staticClass:"mobile_search_wrap"},[t.selectMode?t._e():a("div",{ref:"mobileSearchBoxFixed",staticClass:"mobile_search_box"},[a("div",{staticClass:"mobile_search_box_left"},[a("Search",{attrs:{disabled:"",placeholder:"点击展开搜索面板",shape:"round"},on:{click:t.openSearchPaneFn},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1),t._v(" "),a("div",{staticClass:"mobile_search_box_right"},[a("div",{staticClass:"mobile_search_box_right_tools",staticStyle:{width:"40px"}},[a("Popover",{attrs:{trigger:"click",actions:t.actions,placement:"bottom-end",theme:"dark"},on:{select:t.onSelect},scopedSlots:t._u([{key:"reference",fn:function(){return[a("Icon",{attrs:{name:"add-o"}})]},proxy:!0}],null,!1,2721235328),model:{value:t.showPopover,callback:function(e){t.showPopover=e},expression:"showPopover"}})],1),t._v(" "),a("div",{staticClass:"mobile_search_box_right_tools",staticStyle:{width:"40px"}},[a("Icon",{attrs:{name:"bars"},on:{click:t.showMoreMenuFn}})],1)])])]),t._v(" "),a("div",{ref:"assetsTableWrap",staticClass:"assets_table_wrap"},[a("div",{staticClass:"assets_table_wrap_content  clearfix"},[a("div",{staticClass:"assets_table_wrap_left"},[a("ul",{staticClass:"assets_table_ul"},[a("li",{staticClass:"assets_table_li assets_table_li_name"},[t.selectMode?a("div",{staticClass:"assets_table_li_checkbox"},[a("Checkbox",{attrs:{"checked-color":"#07c160"},on:{click:t.checkAllFn},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}})],1):a("div",{staticClass:"assets_table_item"},[a("p",[t._v("序号")])])]),t._v(" "),t.selectMode?a("CheckboxGroup",{ref:"checkboxGroup",model:{value:t.checkedArr,callback:function(e){t.checkedArr=e},expression:"checkedArr"}},t._l(t.assetsDetailData,function(t,e){return a("li",{key:e,staticClass:"assets_table_li"},[a("div",{staticClass:"assets_table_li_checkbox"},[a("Checkbox",{attrs:{name:t.assetID,"checked-color":"#07c160"},on:{click:function(t){t.stopPropagation()}}})],1)])}),0):t._l(t.assetsDetailData,function(e,s){return a("li",{key:s,staticClass:"assets_table_li"},[a("div",{staticClass:"assets_table_item"},[a("p",[t._v(t._s(s+1))])])])})],2)]),t._v(" "),a("div",{staticClass:"assets_table_wrap_right"},[a("ul",{staticClass:"assets_table_ul"},[t._m(0),t._v(" "),t._l(t.assetsDetailData,function(e,s){return a("li",{key:s,staticClass:"assets_table_li clearfix"},[a("div",{staticClass:"assets_table_item"},[a("p",[t._v(t._s(e.assetID?e.assetID:"--"))])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v(t._s(e.assetName?e.assetName:"--"))])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v(t._s(e.locDept?e.locDept:"--"))])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v(t._s(e.location?e.location:"--"))])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v(t._s(e.mac?e.mac:"--"))])]),t._v(" "),a("div",{staticClass:"assets_table_item"},["正常"===e.status?a("Tag",{attrs:{size:"medium",color:t.statusColor[0]}},[t._v(t._s(e.status))]):"待维修"===e.status?a("Tag",{attrs:{size:"medium",color:t.statusColor[1]}},[t._v(t._s(e.status))]):"维修接单"===e.status?a("Tag",{attrs:{size:"medium",color:t.statusColor[2]}},[t._v(t._s(e.status))]):"待报废"===e.status?a("Tag",{attrs:{size:"medium",color:t.statusColor[3]}},[t._v(t._s(e.status))]):"报废"===e.status?a("Tag",{attrs:{size:"medium",color:t.statusColor[4]}},[t._v(t._s(e.status))]):"外借"===e.status?a("Tag",{attrs:{size:"medium",color:t.statusColor[5]}},[t._v(t._s(e.status))]):a("Tag",{attrs:{size:"medium",color:"#f7f7f7","text-color":"#515a6e"}},[t._v(t._s(e.status))])],1)])})],2)])]),t._v(" "),a("div",{staticClass:"loading_info_wrap"},[a("Pagination",{directives:[{name:"show",rawName:"v-show",value:t.showPagination&&t.assetsDetailData.length,expression:"showPagination&&assetsDetailData.length"}],attrs:{"total-items":t.totalCount,"show-page-size":2,"prev-text":"上一页","next-text":"下一页","force-ellipses":"",mode:"simple"},on:{change:t.changePageFn},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}}),t._v(" "),a("Loading",{directives:[{name:"show",rawName:"v-show",value:t.loadingShow,expression:"loadingShow"}],attrs:{size:"24px"}},[t._v("加载中...")]),t._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:!t.loadingShow&&!t.assetsDetailData.length,expression:"!loadingShow&&!assetsDetailData.length"}]},[t._v("暂无数据")])],1)]),t._v(" "),a("Popup",{attrs:{position:"top",round:""},model:{value:t.showSearchPane,callback:function(e){t.showSearchPane=e},expression:"showSearchPane"}},[a("div",{staticClass:"query_data_wrap"},[a("div",{staticClass:"query_data_box"},[a("Field",{attrs:{clearable:"",label:"资产编号",placeholder:"请输入资产编号"},model:{value:t.queryData.assetID,callback:function(e){t.$set(t.queryData,"assetID",e)},expression:"queryData.assetID"}}),t._v(" "),a("Field",{attrs:{clearable:"",label:"资产名称",center:"",placeholder:"请输入资产名称"},scopedSlots:t._u([{key:"button",fn:function(){return[a("Button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.showInputSearchFn("assetName")}}},[t._v("云数据")])]},proxy:!0}]),model:{value:t.queryData.assetName,callback:function(e){t.$set(t.queryData,"assetName",e)},expression:"queryData.assetName"}}),t._v(" "),a("Field",{attrs:{clearable:"",label:"部门名称",center:"",placeholder:"请输入部门名称"},scopedSlots:t._u([{key:"button",fn:function(){return[a("Button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.showInputSearchFn("departmentroom")}}},[t._v("云数据")])]},proxy:!0}]),model:{value:t.queryData.memorydepart,callback:function(e){t.$set(t.queryData,"memorydepart",e)},expression:"queryData.memorydepart"}}),t._v(" "),a("Field",{attrs:{clearable:"",label:"所在科室",center:"",placeholder:"请输入所在科室"},scopedSlots:t._u([{key:"button",fn:function(){return[a("Button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.showInputSearchFn("locDept")}}},[t._v("云数据")])]},proxy:!0}]),model:{value:t.queryData.memorylocDept,callback:function(e){t.$set(t.queryData,"memorylocDept",e)},expression:"queryData.memorylocDept"}}),t._v(" "),a("Field",{attrs:{clearable:"",label:"标签mac",placeholder:"请输入标签mac"},model:{value:t.queryData.mac,callback:function(e){t.$set(t.queryData,"mac",e)},expression:"queryData.mac"}}),t._v(" "),a("Field",{attrs:{readonly:"",label:"状态",placeholder:"请选择状态"},on:{click:function(e){t.statusDialogShow=!0}},model:{value:t.queryData.status,callback:function(e){t.$set(t.queryData,"status",e)},expression:"queryData.status"}})],1),t._v(" "),a("div",{staticClass:"tools_button_wrap"},[a("Button",{staticClass:"tools_button",attrs:{color:"linear-gradient(to right, #ff6034, #ee0a24)",round:""},on:{click:t.clearAssetsFn}},[t._v("清空")]),t._v(" "),a("Button",{staticClass:"tools_button",attrs:{color:"linear-gradient(to right, #69aff5, #1989fa)",round:""},on:{click:t.searchFn}},[t._v("搜索")])],1)])]),t._v(" "),a("Popup",{attrs:{position:"bottom"},model:{value:t.statusDialogShow,callback:function(e){t.statusDialogShow=e},expression:"statusDialogShow"}},[a("Picker",{attrs:{columns:t.statusData,"show-toolbar":"",title:"请选择状态","visible-item-count":5},on:{cancel:function(e){t.statusDialogShow=!1},confirm:t.getStatusFn}})],1),t._v(" "),a("Popup",{attrs:{position:"bottom"},model:{value:t.showInputSearch,callback:function(e){t.showInputSearch=e},expression:"showInputSearch"}},[a("Search",{attrs:{placeholder:"请输入搜索关键词","input-align":"center"},on:{input:t.handleSearchFn},model:{value:t.inputSearchValue,callback:function(e){t.inputSearchValue=e},expression:"inputSearchValue"}}),t._v(" "),a("Picker",{ref:"inputSelect",attrs:{"show-toolbar":"","toolbar-position":"bottom",columns:t.inputData,title:"","visible-item-count":5},on:{cancel:function(e){t.showInputSearch=!1},confirm:t.certainSelectFn}})],1),t._v(" "),a("div",{class:t.selectMode?"header_tools_wrap show":"header_tools_wrap"},[a("Button",{attrs:{round:"",size:"small",type:"info"},on:{click:t.exitSelectFn}},[t._v("完成")])],1),t._v(" "),a("div",{class:t.selectMode?"footer_tools_wrap show":"footer_tools_wrap"},[a("Button",{attrs:{round:"",size:"small",type:"warning"},on:{click:t.toCheckFn}},[t._v("盘点")])],1)],1)},staticRenderFns:[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("li",{staticClass:"assets_table_li assets_table_li_name clearfix"},[a("div",{staticClass:"assets_table_item"},[a("p",[t._v("资产编号")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("资产名称")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("科室名称")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("存放地点")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("标签mac")])]),t._v(" "),a("div",{staticClass:"assets_table_item"},[a("p",[t._v("状态")])])])}]};var d=a("VU/8")(p,_,!1,function(t){a("s154")},"data-v-65865af0",null);e.default=d.exports},OeKT:function(t,e,a){a("XqYu"),a("ozXw")},d9cu:function(t,e,a){a("XqYu"),a("j7dL"),a("9fCr"),a("6d7H")},ozXw:function(t,e){},s154:function(t,e){}});